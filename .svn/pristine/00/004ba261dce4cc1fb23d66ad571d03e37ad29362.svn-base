<div class="main-content">
    <div id="addUser" class="popLayer">
        <div class="breadcrumbs">
            <ul class="breadcrumb">
                <li>添加任务</li>
            </ul>
            <!-- .breadcrumb -->
            <span class="floatRig closePop">关闭</span>
        </div>
        <div class="col-sm-12">
            <div class="row">
                <div class="col-xs-win">
                    <!-- PAGE CONTENT BEGINS -->
                    <form style="position:relative;margin-top:20px;" id="addUser_form" class="form-horizontal" role="form">

                        <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right"> 类型： </label>
                            <div class="col-sm-9">
                                <select name="types" class="typeOption" required>
                                    <option value="waf" >waf</option>
                                    <option value="vds" >vds</option>
                                    <option value="分析" >分析</option>
                                </select>
                            </div>
                        </div>
                        <div class="space-4"></div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right"> 名称：</label>
                            <div class="col-sm-9">
                                <input type="text" name="name" required style="width: 300px" required/>
                            </div>
                        </div>
                        <div class="space-4"></div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right">时间：</label>
                            <div class="input-group w300 floatLeft" style="width:300px; text-indent:0px;margin-left: 12px" id="ischeck">
                                <span class="input-group-addon">
                                    <i class="icon-calendar bigger-110"></i>
                                </span>
                                <input class="form-control date-range-picker" type="text" name="date" data-date-format="YYYY-MM-DD" id="id-date-range-picker-2" required />
                                <!--<input class="form-control date-range-picker" type="text" name="da2" data-date-format="YYYY-MM-DD hh" id="id-date-range-picker-2" />-->
                            </div>
                        </div>
                        <div class="space-4"></div>

                        <!-- <div class="form-group">
                            <label class="col-sm-3 control-label no-padding-right"> 权重：</label>
                            <div class="col-sm-9">
                                <input type="text" name="weight"  required style="width: 300px" required/>
                            </div>
                        </div> -->

                        <div class="space-4"></div>
                        <div class="clearfix form-actions">
                            <div>
                                <button class="btn btn-info" type="submit">
                                    <i class="icon-ok bigger-110"></i>
                                    确认
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </div>
    </div>
    <div id="fade" class="black_overlay"></div>
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try {
                ace.settings.check('breadcrumbs', 'fixed')
            } catch (e) {
            }
        </script>

        <ul class="breadcrumb">
            <li>
                安全事件
            </li>
            <li class="active">离线调度检测</li>
        </ul>
        <!-- .breadcrumb -->
        <!-- #nav-search -->
    </div>
    <div class="col-sm-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="formArea marT10">
                    <form method="get" action="offline">
                    <div class="formTextList" style="min-width: 358px">
                        <label class="floatLeft">创建时间：</label>
                        <div class="input-group w300 floatLeft" style="width:281px; text-indent:0px;">
                            <span class="input-group-addon">
                                <i class="icon-calendar bigger-110"></i>
                            </span>
                            <input class="form-control date-range-picker" type="text" name="times" data-date-format="YYYY-MM-DD" id="id-date-range-picker-2" />
                        </div>
                    </div>
                    <div class="formTextList" >
                        <label class="floatLeft">类型：</label>
                        <select name="types" class="floatLeft types">
                            <option value="">全部</option>
                            <option value="vds">vds</option>
                            <option value="waf">waf</option>
                            <option value="分析">分析</option>
                        </select>
                    </div>
                    <div class="formTextList" >
                        <label class="floatLeft">状态：</label>
                        <select name="status" class="floatLeft status">
                            <option value="">全部</option>
                            <option value="未开始">未开始</option>
                            <option value="进行中">进行中</option>
                            <option value="已终止">已终止</option>
                            <option value="已完成">已完成</option>
                        </select>
                    </div>
                    <button class="btn btn-sm btn-primary marL10"><i class="fa fa-search"></i>查询</button>
                    <div class="clearBoth"></div>
                    </form>
                </div>
                <div class="aptTable formArea marT10">
                    <div style="margin: 10px; width: 98%;">
                        <div class="aptListBtnGroup" style="left: 5px;">
                            <a href="#" class="" id="userAdd"><i class="icon-plus-sign bigger-120 green"></i>添加</a>
                            <a href="#" class="" id="Scanning"><i class="icon-align-justify bigger-120 green"></i>扫描进度</a>
                            <div id="jindu"  class="blockDiv hide">
                                <ul class="jinduList bg" style="width: 100%;margin: 0;">
                                    <li style="width: 82px">
                                        <div class="row" style="width: 82px;margin:6px 0;text-align: center">
                                            任务名称
                                        </div></li>
                                    <li>
                                        <div class="row" style="width: 168px;margin: 6px 0;text-align: center">
                                            picker扫描
                                        </div>
                                    </li>
                                    <li >
                                        <div class="row" style="width: 168px;margin: 6px 0;text-align: center">
                                            agent扫描
                                        </div>
                                    </li>
                                </ul>
                                <ul class="jinduList">
                                    <li style="width: 82px;line-height: 35px">waf_offline1</li>
                                    <li>
                                        <div class="row" style="width: 168px;margin: 10px 0 0 6px">
                                            <div class="beHalf" style="margin-left: 4px">
                                                <div class="progress" style="margin-bottom: 12px" >
                                                    <div class="progress-bar progress-bar-info progress-bar-striped active" style="width: 0%">
                                                        <span class="showing" style="color:#57BB5B"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            </div>
                                    </li>
                                    <li>
                                        <div class="row" style="width: 168px;margin: 10px 0 0 6px">
                                            <div class="beHalf" style="margin-left: 4px">
                                                <div class="progress" style="margin-bottom: 12px">
                                                    <div class="progress-bar progress-bar-info progress-bar-striped active" style="width: 0%">
                                                        <span class="showing" style="color:#57BB5B"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <ul class="jinduList">
                                    <li style="width: 82px;line-height: 35px">waf_offline1</li>
                                    <li>
                                        <div class="row" style="width: 168px;margin: 10px 0 0 6px">
                                            <div class="beHalf" style="margin-left: 4px">
                                                <div class="progress" style="margin-bottom: 12px" >
                                                    <div class="progress-bar progress-bar-info progress-bar-striped active" style="width: 0%">
                                                        <span class="showing" style="color:#57BB5B"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <li>
                                        <div class="row" style="width: 168px;margin: 10px 0 0 6px">
                                            <div class="beHalf" style="margin-left: 4px">
                                                <div class="progress" style="margin-bottom: 12px">
                                                    <div class="progress-bar progress-bar-info progress-bar-striped active" style="width: 0%">
                                                        <span class="showing" style="color:#57BB5B"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                </ul>
                                <div class="clearBoth"></div>
                                </div>

                            </div>
                        </div>

                        <table id="processTable" class="table table-striped table-bordered table-hover" style="margin-top: 50px">
                            <thead>
                            <tr style="height: 37px;">
                               <!-- <th style="width:12%;">任务名称</th>
                                <th style="width:5%;">类型</th>
                                <th style="width:40%;">扫描进度</th>
                                <th style="width:5%;">状态</th>
                                <th style="width:12%;">创建时间</th>
                                <th style="width:15%;">离线数据起始时间</th>
                                <th style="width: 10%">编辑</th>-->
                                <th >任务名称</th>
                                <th >类型</th>
                                <!--<th >扫描进度</th>-->
                                <th >状态</th>
                                <th >创建时间</th>
                                <th >离线数据起始时间</th>
                                <th >编辑</th>
                            </tr>
                            </thead>
                            <tbody>
                            <volist name="off_data" id="data">
                            <tr style="height: 37px;">
                                <td class="beCenter">{$data['name']}</td>
                                <td class="beCenter">{$data['types']}</td>
                                <!--<td class="jinDuStyle">
                                    <div class="row" style="width: 100%">
                                        <div class="beHalf" style="margin-left: 7px">
                                            <div class="progress" >
                                                <div class="progress-bar progress-bar-info progress-bar-striped active" style="width: 0%">
                                                    <span class="showing" style="color:#F6F6DC"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="beHalf">
                                            <div class="progress" style="margin-bottom: 0px;display: inline-block; ">
                                                <div class="progress-bar progress-bar-success progress-bar-striped active" style=" ">
                                                    <span class="showing" style="color:#F6F6DC"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>-->
                                <td class="beCenter statusStation">{$data['status']}</td>
                                <td class="beCenter">{$data['times']|date='Y/m/d H:i:s',###}</td>
                                <td class="beCenter">{$data['start']}-{$data['end']}</td>
                                <td class="beCenter">
                                    <div >
                                        <if condition="$data['status'] eq '未开始'">
                                        <a class="operateStart" href="javascript:;" title="开始">
                                            <i class="icon-step-forward  bigger-130 green" style="margin: 0"></i>
                                        </a>
                                        <a href="javascript:;" title="终止">
                                            <i class="icon-stop  bigger-130 gray" ></i>
                                        </a>
                                        <a class="operateDelete"  href="javascript:;"  title="删除">
                                            <i class="icon-trash bigger-140 red"></i>
                                        </a>
                                        <a title="查看">
                                            <i class="icon-adjust bigger-140 gray"></i>
                                        </a> 
                                        </if>
                                        <if condition="$data['status'] eq '进行中'">
                                        <a  href="javascript:;" title="开始">
                                            <i class="icon-step-forward  bigger-130 gray" ></i>
                                        </a>
                                        <a class="operateStop" href="javascript:;" title="终止">
                                            <i class="icon-stop  bigger-130 red" ></i>
                                        </a>
                                        <a  href="javascript:;"  title="删除">
                                            <i class="icon-trash bigger-140 gray"></i>
                                        </a>
                                        <a class="operateWatch"  href="__URL__/offLine_details"  title="查看">
                                            <i class="icon-adjust bigger-140"></i>
                                        </a> 
                                        </if>
                                        
                                        <if condition="$data['status'] eq '已终止'">
                                        <a  href="javascript:;" title="开始">
                                            <i class="icon-step-forward  bigger-130 gray" ></i>
                                        </a>
                                        <a  href="javascript:;" title="终止">
                                            <i class="icon-stop  bigger-130 gray" ></i>
                                        </a>
                                        <a class="operateDelete"  href="javascript:;"  title="删除">
                                            <i class="icon-trash bigger-140 red"></i>
                                        </a>
                                        <a class="operateWatch"  href="__URL__/offLine_details"  title="查看">
                                            <i class="icon-adjust bigger-140"></i>
                                        </a> 
                                        </if>
                                        <if condition="$data['status'] eq '已完成'">
                                        <a  href="javascript:;" title="开始">
                                            <i class="icon-step-forward  bigger-130 gray" ></i>
                                        </a>
                                        <a  href="javascript:;" title="终止">
                                            <i class="icon-stop  bigger-130 gray" ></i>
                                        </a>
                                        <a  href="javascript:;"  title="删除">
                                            <i class="icon-trash bigger-140 gray"></i>
                                        </a>
                                        <a class="operateWatch"  href="__URL__/offLine_details"  title="查看">
                                            <i class="icon-adjust bigger-140"></i>
                                        </a> 
                                        </if>
                                    </div>
                                </td>
                            </tr>
                            </volist>
                            </tbody>
                        </table>
                    </div>
                    <div class="dataTables_paginate paging_bootstrap">
                        <ul class="pagination">
                            {$show}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script type="text/javascript">
$("input[name='times']").attr('value',URLdecode(getParam("times")));
$(".types").attr('value',decodeURI(getParam('types')));
$(".status").attr('value',decodeURI(getParam('status')));
function URLdecode(sStr){
   return sStr.replace(/\+/g,' ').replace(/\%2F/g,'\/').replace(/\%20/g,''); 
}
function getParam(paramName)
{
    paramValue = "";
    isFound = false;
    if (this.location.search.indexOf("?") == 0 && this.location.search.indexOf("=")>1)
    {
        arrSource = this.location.search.substring(1,this.location.search.length).split("&");
        i = 0;
        while (i < arrSource.length && !isFound)
        {
            if (arrSource[i].indexOf("=") > 0)
            {
                if (arrSource[i].split("=")[0].toLowerCase()==paramName.toLowerCase())
                {
                    paramValue = arrSource[i].split("=")[1];
                    isFound = true;
                }
            }
            i++;
        }
    }
    return paramValue;
}
$(document).on("click","#userAdd",function(){
    $("#addUser").show();
    $("#fade").show();
    return false
});
$('#addUser_form').submit(function(e){
    e.stopPropagation();
    e.preventDefault();
    var data = $('#addUser_form').serialize();
    $.ajax({
        type:"POST",
        url: "__URL__/offline_add",
        data: data,
        dataType: "json",
        success:function(data){
            if(data.status=='success'){
                $("#addUser").hide();
                $("#fade").hide();
                $('#addUser_form')[0].reset();
                layer.msg(data.msg);
                window.location.reload();
            }else{
                layer.msg(data.msg); 
            }
        }
    });
})
$(".closePop").css("cursor", "pointer").click(function () {
    $("#addUser").hide();
    $("#editeUser").hide();
    $("#fade").hide();
    $(":checked").attr('checked',false);
});
jQuery(function ($) {
    $('.date-range-picker').daterangepicker({
        startDate: moment().subtract(29, 'days'),
        endDate: moment(),
        maxDate : moment(),
        format : 'YYYY/MM/DD', //控件中from和to 显示的日期格式
        locale : {
            applyLabel: '提交',
            cancelLabel: '取消',
            fromLabel: '开始时间',
            toLabel: '结束时间',
            weekLabel: 'W',
            customRangeLabel: 'Custom Range',
            daysOfWeek: ['日', '一', '二', '三', '四', '五','六'],
            monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
            firstDay: moment.localeData()._week.dow
        },
//                    startDate: moment().startOf('day'),
//                    minValidDate: '315507600000000000000000', //最小可用时间，控制日期选择器的可选力度
        dateLimit : {
            day : 29
        },
        timePickerIncrement : 1440, //时间的增量，单位为分钟
        language: 'cn',}
    ).prev().on(ace.click_event, function () {
        $(this).next().focus();
    });
})

$('#Scanning').hover(function(){
    $('#jindu').removeClass('hide');
},function(){
    $('#jindu').addClass('hide');
})
$('#jindu').hover(function(){
    $('#jindu').removeClass('hide');
},function(){
    $('#jindu').addClass('hide');
})

    //点击开始，进行滚动条：operateStart
    $(document).on("click",".operateStart", function() {
        /* if( $(this).children().hasClass('gray')){
            return;
        }
        var $processBar=$(this).parent('tr')
        console.log($(this).parents('tr').children('td:eq(2)').html())
//        $(this).parents('tr').children('td:eq(2)').children('.showing').html('20%')
        var $processBar = $('.progress-bar');
        var $statusStation = $(".statusStation");
        $statusStation.html("进行中");
        var barWidth = $processBar.css('width');//获取得到后台数据
//        $('.showing').html('20%');
        barWidth = 76;//写死的数据
        for (var i = 0; i <= barWidth; i++) {
            (function(j){
                setTimeout(function () {
                    $('.showing').html(j+'%');
                }, 15*j)
            })(i);
        }

//中止
        $(this).next().children().removeClass('gray')
        $(this).next().children().addClass('red')
//开始
        $(this).children().removeClass('green')
        $(this).children().addClass('gray')
        //删除
        $(this).next().next().children().removeClass('red')
        $(this).next().next().children().addClass('gray')
//查看
        $(this).next().next().next().children().removeClass('gray')*/
        });
    //设置终止点击，开始，终止禁止，可删除，查看
        $('.operateStop').on("click", function () {
           /* if($(this).children().hasClass('gray')){
                return false;
            }
            //删除
            $(this).next().children('').removeClass('gray')
            $(this).next().children().addClass('red')
//        中止
            $(this).children().removeClass('red')
            $(this).children().addClass('gray')*/

        });
       /* if(barWidth == 100){
            $statusStation.html("已完成");
            //设置状态100%，开始，终止，删除禁止，可查看
            //        中止
            $(this).children().removeClass('red')
            $(this).children().addClass('gray')
            $('.operateDelete').on("click", function () {
                return false;
            });
        }
        $processBar.css('width', barWidth+'%');*/
//    });
    
    $(".closePop").css("cursor", "pointer").click(function () {
        $("#addUser").hide();
        $("#editeUser").hide();
        $("#fade").hide();
        $(":checked").attr('checked',false);
    });
    jQuery(function ($) {
        $('.date-range-picker').daterangepicker({
            startDate: moment().subtract(29, 'days'),
            endDate: moment(),
            maxDate : moment(),
            format : 'YYYY/MM/DD', //控件中from和to 显示的日期格式
            locale : {
                applyLabel: '提交',
                cancelLabel: '取消',
                fromLabel: '开始时间',
                toLabel: '结束时间',
                weekLabel: 'W',
                customRangeLabel: 'Custom Range',
                daysOfWeek: ['日', '一', '二', '三', '四', '五','六'],
                monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                firstDay: moment.localeData()._week.dow
            },
//                    startDate: moment().startOf('day'),
//                    minValidDate: '315507600000000000000000', //最小可用时间，控制日期选择器的可选力度
            dateLimit : {
                day : 29
            },
            timePickerIncrement : 1440, //时间的增量，单位为分钟
            language: 'cn',}
        ).prev().on(ace.click_event, function () {
            $(this).next().focus();
        });
    })
</script>

