(function(aN){function aq(bp){bp=bp||{};var bm=null,bI=null,bE=bp["gridDom"],bk=bp["onnewcell"];if(typeof(bk)!=="function"){bk=false;}var bA=null,bG=null,bq=null;var bH=bp["checklayoutinfo"];if(bE&&typeof(bH)==="function"){var bw=bH(bE,I,bp);bq=bw[0],bA=bw[1],bG=bw[2];}else{bA=I(bp["widths"]);bG=I(bp["heights"]);bq=F(bp["cells"],bG.length,bA.length);if(bE){Y(bE,bq,bk);}else{var bt=bp["parentElement"];if(!(bt&&bt.appendChild)){bm=bp["wnd"]||window,bI=bm.document,bt=bI.body;}bE=aL(bt,bq,bk);}}bE.style.cssText+="; overflow: hidden; "+(bp["css4griddom"]||"");if(!bI){bI=bE.ownerDocument;bm=bI.parentWindow||bI.defaultView;}var by=bG.length-1,bv=bA.length-1,br=X(bp["fixedrows"],by),bu=X(bp["fixedcols"],bv),bB=X(bp["stretchedrows"],by),bC=X(bp["stretchedcols"],bv);var bF=parseInt(bp["gap"]),bl=parseInt(bp["hgap"]),bo=parseInt(bp["vgap"]);if(isNaN(bF)||bF<0){bF=0;}if(isNaN(bl)||bl<0){bl=bF;}if(isNaN(bo)||bo<0){bo=bF;}var bj=parseFloat(bp["defwidth"]),bi=parseFloat(bp["defheight"]);if(isNaN(bj)||bj<=0){bj=20;}if(isNaN(bi)||bi<=0){bi=20;}var bz=parseFloat(bp["mincolwidth"]),bD=parseFloat(bp["minrowheight"]);if(isNaN(bz)||bz<0){bz=0;}if(isNaN(bD)||bD<0){bD=0;}this.wnd=bm;this.doc=bI;this._property={gap:bF,hgap:bl,vgap:bo,widths:bA,heights:bG,defwidth:bj,defheight:bi,mincolwidth:bz,minrowheight:bD,fixedrows:br,fixedcols:bu,stretchedrows:bB,stretchedcols:bC,extwidth:an(bp["extwidth"]),extheight:an(bp["extheight"]),layoutstatus:[a7(bE),aB(bE,true)],cells:bq,gridDom:bE,onnewcell:bk,eventsmap:{},ishorizonfixed:bp["ishorizonfixed"]===true,isverticalfixed:bp["isverticalfixed"]===true,drawsplitonce:bp["drawsplitonce"]!==false,enableselect:false,enablelayout:false,enabledrawsplit:false};this.setProperty(aJ,ac(bA,bu));this.setProperty(aT,ac(bG,br));this.enableLayout(bp["enablelayout"]);this.enableSelect(bp["enableselect"]);var bx=bp["events"];if(bx){for(var bn in bx){this.attachEvent(bn,bx[bn]);}}var bs=bp["oninit"];if(typeof(bs)==="function"){bs(this,bE,bA,bG);}this.doLayout(true);disableDocTextSelect(bE);}if(!window["EventHandler"]){include(sys.getContextPath()+"esmain/pagedesigner/js/eventhandler.js");}extendClass(aq,EventHandler,"XGridLayout");var aa="rs",a4="cs",ae="dom",ap="r",ax="c",ba="layout_",D="h",G="v",aJ="widthstate",aT="heightstate",h=/^\d+(\.\d+)?%$/;var M="onlayout",aw="onrelayout",ai="onproperty",f="oninsertrow",bf="ondeleterow",at="oninsertcol",al="ondeletecol",J="onmergecell",aE="onsplitcell",e="oncellchange",m="onselectset",r="onselectclear",L="onselectcontext",az="onseparatebefore",Z="onseparateafter",B="onmouselayout",a5="onenablelayout",u="onenableselect",p="onenabledrawsplit",k="ondispose";aq.prototype.getEventsMap=function(){return this._property["eventsmap"];};aq.prototype.dispose=function(){var bj=this._property;if(!bj){return;}if(bj["timeout_dolayout"]){clearTimeout(bj["timeout_dolayout"]);}this.fireEvent(k);var bk=bj["gridDom"],bi=bk.parentNode;$(bk).unbind(".layout");if(bi){bi.removeChild(bk);}this._property=null;bb(this);};aq.prototype.getGridDom=function(){return this._property["gridDom"];};aq.prototype.getCellDom=function(bk,bj){var bi=this.getCell.apply(this,arguments);return bi?bi[ae]:null;};aq.prototype.getCell=function(bs,bj){var bp=this._property,br=bp["cells"],bl=arguments.length;if(bl===0){return br;}else{if(bl===1){if(bs.nodeType===1){var bk=null,bq=null;for(var bi=0,bo=br.length;bi<bo;bi++){bk=br[bi];for(var bm=0,bn=bk.length;bm<bn;bm++){bq=bk[bm];if(bq[ae]===bs){return{dom:bs,r:bi,c:bm,rs:bq[aa],cs:bq[a4]};}}}}}else{var bk=br[bs],bq=bk?bk[bj]:null;if(bq){if(!bq[ae]){bq=br[bs=bq[ap]][bj=bq[ax]];}return{dom:bq[ae],r:bs,c:bj,rs:bq[aa],cs:bq[a4]};}}}return null;};aq.prototype.getRowCount=function(){return this._property["heights"].length;};aq.prototype.getColCount=function(){return this._property["widths"].length;};aq.prototype.getWidth=function(){var bk=this._property["layoutstatus"];if(arguments.length===0){return bk[0];}var bj=bk[2],bi=parseInt(arguments[0]);return isNaN(bi)||bi<0||bi>=bj.length?bj:bj[bi];};aq.prototype.getHeight=function(){var bk=this._property["layoutstatus"];if(arguments.length===0){return bk[1];}var bi=bk[3],bj=parseInt(arguments[0]);return isNaN(bj)||bj<0||bj>=bi.length?bi:bi[bj];};aq.prototype.getColWidth=function(bi){var bk=this._property["widths"];if(bi==null){return bk.concat();}bi=parseInt(bi);if(isNaN(bi)||bi<0||bi>=bk.length){return;}var bj=bk[bi];return bj<0?(-(bj*100).toRound(2)+"%"):bj;};aq.prototype.setColWidth=function(bi,bj){var bl=this._property,bk=bl["widths"];if(arguments.length===1){if(bi.length!==bk.length){return false;}bk=bl["widths"]=I(bi);bi=null;}else{bi=parseInt(bi);if(isNaN(bi)||bi<0||bk.length<=bi){return false;}if(h.test(bj)){bj=-(parseFloat(bj)/100);if(bk[bi]===bj){return false;}}else{bj=parseFloat(bj);if(isNaN(bj)||bj<0||bk[bi]===bj){return false;}}bk[bi]=bj.toRound(2);}this.setProperty(aJ,ac(bk,bl["fixedcols"]));this.doLayout(true);return this.getColWidth(bi);};aq.prototype.getRowHeight=function(bk){var bj=this._property["heights"];if(bk==null){return bj.concat();}bk=parseInt(bk);if(isNaN(bk)||bk<0||bk>=bj.length){return;}var bi=bj[bk];return bi<0?(-(bi*100).toRound(2)+"%"):bi;};aq.prototype.setRowHeight=function(bl,bi){var bk=this._property,bj=bk["heights"];if(arguments.length===1){if(bl.length!==bj.length){return false;}bj=bk["heights"]=I(bl);bl=null;}else{bl=parseInt(bl);if(isNaN(bl)||bl<0||bj.length<=bl){return false;}if(h.test(bi)){bi=-(parseFloat(bi)/100);if(bj[bl]===bi){return false;}}else{bi=parseFloat(bi);if(isNaN(bi)||bi<0||bj[bl]===bi){return false;}}bj[bl]=bi.toRound(2);}this.setProperty(aT,ac(bj,bk["fixedrows"]));this.doLayout(true);return this.getRowHeight(bl);};aq.prototype.isHorizonFixed=function(){if(arguments[0]===true){var bi=this.getProperty(aJ);return !a1(bi)&&(this._property["ishorizonfixed"]||V(bi));}return this._property["ishorizonfixed"];};aq.prototype.setHorizonFixed=function(bi){var bj=this._property;bi=parseBool(bi,false);if(bj["ishorizonfixed"]===bi){return false;}bj["ishorizonfixed"]=bi;this.doLayout(true);};aq.prototype.isVerticalFixed=function(){if(arguments[0]===true){var bi=this.getProperty(aT);return !a1(bi)&&(this._property["isverticalfixed"]||V(bi));}return this._property["isverticalfixed"];};aq.prototype.setVerticalFixed=function(){var bi=this._property;fixed=parseBool(fixed,false);if(bi["isverticalfixed"]===fixed){return false;}bi["isverticalfixed"]=fixed;this.doLayout(true);};aq.prototype.getFixedRows=function(){var bi=this._property["fixedrows"];return arguments.length===1?(bi.indexOf(arguments[0])!==-1):bi.concat();};aq.prototype.setRowFixed=function(bn,bk){var bm=this._property,bl=bm["heights"],bj=null;if(arguments.length===1){if(isString(bn)){bn=bn.split(",");}else{if(!isArray(bn)){bn=[bn];}}bj=bm["fixedrows"]=X(bn,bl.length-1);bn=null;}else{bn=parseInt(bn);if(isNaN(bn)||bn<0){return;}if(bn>=bl.length){return;}bj=bm["fixedrows"];var bi=bj.indexOf(bn);bk=parseBool(bk,true);if(bk){if(bi!==-1){return;}bj.push(bn);}else{if(bi===-1){return;}bj.splice(bi,1);}}this.setProperty(aT,ac(bl,bj));this.doLayout(true);return bk;};aq.prototype.getFixedCols=function(){var bi=this._property["fixedcols"];return arguments.length===1?(bi.indexOf(arguments[0])!==-1):bi.concat();};aq.prototype.setColFixed=function(bk,bm){var bn=this._property,bl=bn["widths"],bj=null;if(arguments.length===1){if(isString(bk)){bk=bk.split(",");}else{if(!isArray(bk)){bk=[bk];}}bj=bn["fixedcols"]=X(bk,bl.length-1);}else{bk=parseInt(bk);if(isNaN(bk)||bk<0){return;}if(bk>=bl.length){return;}bj=bn["fixedcols"];var bi=bj.indexOf(bk);bm=parseBool(bm,true);if(bm){if(bi!==-1){return;}bj.push(bk);}else{if(bi===-1){return;}bj.splice(bi,1);}}this.setProperty(aJ,ac(bl,bj));this.doLayout(true);return bm;};aq.prototype.setRowStretched=function(bm,bk){var bl=this._property;if(arguments.length===1){if(isString(bm)){bm=bm.split(",");}else{if(!isArray(bm)){bm=[bm];}}bl["stretchedrows"]=X(bm,bl["heights"].length-1);}else{bm=parseInt(bm);if(isNaN(bm)||bm<0){return;}if(bm>=bl["heights"].length){return;}var bj=bl["stretchedrows"],bi=bj.indexOf(bm);bk=parseBool(bk,true);if(bk){if(bi!==-1){return;}bj.push(bm);}else{if(bi===-1){return;}bj.splice(bi,1);}}this.doLayout(true);return bk;};aq.prototype.getStretchedRows=function(){var bi=this._property["stretchedrows"];return arguments.length===1?(bi.indexOf(arguments[0])!==-1):bi.concat();};aq.prototype.setColStretched=function(bl,bk){var bm=this._property;if(arguments.length===1){if(isString(bl)){bl=bl.split(",");}else{if(!isArray(bl)){bl=[bl];}}bm["stretchedcols"]=X(bl,bm["widths"].length-1);}else{bl=parseInt(bl);if(isNaN(bl)||bl<0){return;}if(bl>=bm["widths"].length){return;}var bj=bm["stretchedcols"],bi=bj.indexOf(bl);bk=parseBool(bk,true);if(bk){if(bi!==-1){return;}bj.push(bl);}else{if(bi===-1){return;}bj.splice(bi,1);}}this.doLayout(true);return bk;};aq.prototype.getStretchedCols=function(){var bi=this._property["stretchedcols"];return arguments.length===1?(bi.indexOf(arguments[0])!==-1):bi.concat();};var l=["gap","hgap","vgap"];aq.prototype.getGap=function(bi){return this._property[l.indexOf(bi)!==-1?bi:(l[bi]||l[0])];};aq.prototype.setGap=function(bi,bl){bl=parseInt(bl);if(isNaN(bl)||bl<0){return false;}var bj=l.indexOf(bi)!==-1?bi:l[bi];if(!bj){return false;}var bk=this._property;if(bk[bj]===bl){return false;}bk[bj]=bl;this.doLayout(true);};function W(bl,bk,bm,bi){if(bm>bi){return -1;}var bj=Math.floor((bm+bi)/2);if(bl[bj]<=bk&&bl[bj+1]>=bk){return bj;}if(bl[bj]>bk){return bj==bi?-1:W(bl,bk,bm,bj);}else{return bj==bm?-1:W(bl,bk,bj,bi);}}aq.prototype.getRowcolByPoint=function(bi,bp){var bl=this._property,bo=bl["layoutstatus"],bj=bo[4],bm=bo[5];var bn=W(bm,bp,0,bm.length-1),bk=W(bj,bi,0,bj.length-1);if(bn==-1||bk==-1){return null;}return[bn,bk];};aq.prototype.getRowByPoint=function(bl){var bi=this._property,bj=bi["layoutstatus"][5],bk=W(bj,bl,0,bj.length-1);return bk===-1?null:[bk,bl-bj[bk],bj[bk+1]-bl-bi["vgap"]];};aq.prototype.getColByPoint=function(bi){var bl=this._property,bj=bl["layoutstatus"][4],bk=W(bj,bi,0,bj.length-1);return bk===-1?null:[bk,bi-bj[bk],bj[bk+1]-bi-bl["hgap"]];};aq.prototype.browseCells=function(bu,bp,bn){if(typeof(bu)!=="function"){return;}var bs=this._property,bv=bs["cells"],bm=null,bt=null,bl=null;var bo=null,bj=null,br=null,bk=null;if(bn&&bn.length===4){bo=bn[0],bj=bn[1],br=bn[2],bk=bn[3];}else{bo=0,bj=0,br=bs["heights"].length-1,bk=bs["widths"].length-1;}for(var bi=bo;bi<=br;bi++){bm=bv[bi];for(var bq=bj;bq<=bk;bq++){bt=bm[bq],bl=bt[ae];if(bl){if(bu.call(this,{dom:bl,r:bi,c:bq,rs:bt[aa],cs:bt[a4]},bp)===false){return false;}}}}return true;};function a9(bi,bk,bn,bm){var bl=null;while(!bl){var bj=bi[bk--];if(!bj){break;}if(bn===-1){bn=bj.length;}while(--bn>=0){if(bl=bj[bn][ae]){break;}}}return bl?bl.nextSibling:bm.firstChild;}function w(bk,bj,bm){if(bm>0){for(var bl=0,bi=bk.length;bl<bi;bl++){if(bk[bl]>=bj){bk[bl]+=bm;}}}else{for(var bl=0,bi=bk.length;bl<bi;bl++){if(bk[bl]>=bj&&(bk[bl]+=bm)<bj){bk.splice(bl--,1);}}}}function aK(bj,bi,bk,bo){if(!bj){return;}var bl=bi+2;var bn=bj[bi],bm=bj[bl];if(bm<bk){return;}if(bo===0){if(bn>bk){bj[bi]=bn+1;}bj[bl]=bm+1;}else{if(bn>=bk){bn=bj[bi]=Math.max(bk,bn+bo);}bm=bj[bl]=Math.max(bk-1,bm+bo);return bo>0||bm>=bn;}}aq.prototype.insertRow=function(bs,bt,bE){bt=parseInt(bt)||1;if(bt<0){return{error:"至少插入一行."};}if(!isArray(bE)){bE=[bE];}var br=this._property,bC=br["heights"],bG=[];for(var bx=0;bx<bt;bx++){var by=bE[bx];if(by&&h.test(by)){by=-(parseFloat(by)/100);}else{by=parseFloat(by);if(isNaN(by)||by<0){by=bx===0?br["defheight"]:bG[0];}}bG[bx]=by.toRound(2);}var bB=bC.length,bm=null;bs=parseInt(bs);if(isNaN(bs)||bs<0||bs>bB){bs=bB;}if(this.fireEvent(f,(bm=[bs,bt,bG]))===false){return{error:"不满足插入行条件."};}var bo=br["cells"],bv=br["widths"].length,bz=br["gridDom"],bw=[],bk=br["onnewcell"],bu=[];if(bs===bB){var bn=a9(bo,bB-1,-1,bz),bi=null,bD=null;for(var bx=0;bx<bt;bx++){bi=bw[bx]=[];for(var bF=0;bF<bv;bF++){bD=bd(bz,bk,bn);bi[bF]={rs:1,cs:1,dom:bD};bu.push({r:bx+bs,c:bF,dom:bD,rs:1,cs:1});}}}else{var bn=a9(bo,bs-1,-1,bz),bi=bo[bs],bl=[],bj=null,bq=null,bA=null,bD=null;for(var bF=0;bF<bv;bF++){bj=bi[bF];if(!bj[ae]){bl[bF]={r:(bq=bj[ap]),c:(bA=bj[ax])};if(bA===bF){bo[bq][bA][aa]+=bt;}}}for(var bx=0;bx<bt;bx++){bi=bw[bx]=[];for(var bF=0;bF<bv;bF++){bj=bl[bF];if(!bj){bD=bd(bz,bk,bn);bi[bF]={rs:1,cs:1,dom:bD};bu.push({r:bx+bs,c:bF,dom:bD,rs:1,cs:1});}else{bi[bF]={r:bj[ap],c:bj[ax]};}}}}bC.splice.apply(bC,[bs,0].concat(bG));bo.splice.apply(bo,[bs,0].concat(bw));var bp=br["fixedrows"];w(bp,bs,bt);w(br["stretchedrows"],bs,bt);aK(br["selectrange"],0,bs,bt);this.setProperty(aT,ac(bC,bp));this.doLayout(true);this.fireEvent(e,["insertRow",bm,bu]);return bu;};aq.prototype.deleteRow=function(bq,br){bq=parseInt(bq);if(isNaN(bq)||bq<0){return{error:"起始删除行不合法."};}br=parseInt(br)||1;if(br<0){return{error:"删除行数不能小于一行."};}var bp=this._property,bz=bp["heights"],by=bz.length,bl=[];if(bq>=by){return{error:"起始删除行不合法."};}br=Math.min(br,by-bq);if(br===by){return{error:"至少要保留一行."};}if(this.fireEvent(bf,bl=[bq,br])===false){return{error:"不满足删除行条件."};}var bm=bp["cells"],bw=bp["gridDom"],bt=[],bx=bq+br;var bj=bm[bq],bu=bp["widths"].length,bk=null,bs=null,bB=null;for(var bA=0;bA<bu;bA+=bk[a4]){bk=bj[bA];if(bk[ae]){continue;}bs=bk[ap],bk=bm[bs][bA];bk[aa]=Math.max(bq-bs,bk[aa]-br);}bj=bm[bx];if(bj){for(var bA=0;bA<bu;bA+=bk[a4]){bk=bj[bA];if(!bk[ae]){bs=bk[ap];if(bs<bq){continue;}bk=bm[bs][bA];var bi=a9(bm,bx,bA,bw);bj[bA]={dom:bB=bk[ae],rs:bk[aa]-bx+bs,cs:bk[a4]};bw[bi?"insertBefore":"appendChild"](bB,bi);bk[ae]=null;}var bo=bk[a4];while(--bo){bj[bo+bA][ap]=bq;}}for(var bv=bx+1;bv<by;bv++){bj=bm[bv];for(var bA=0;bA<bu;bA+=bk[a4]){bk=bj[bA];if(!bk[ae]){bs=bk[ap];if(bs<bq){continue;}bk=bm[bs][bA];bs=Math.max(bs-br,bq);}else{bs=bv-br;}var bo=bk[a4];while(--bo){bj[bo+bA][ap]=bs;}}}}for(var bv=bq;bv<bx;bv++){bj=bm[bv];for(var bA=0;bA<bu;bA++){bk=bj[bA],bB=bk[ae];if(bB){bt.push({r:bv,c:bA,dom:bw.removeChild(bB),rs:bk[aa],cs:bk[a4]});}}}bz.splice(bq,br);bm.splice(bq,br);var bn=bp["fixedrows"];w(bn,bq,-br);w(bp["stretchedrows"],bq,-br);if(aK(bp["selectrange"],0,bq,-br)===false){this.clearSelection();}this.setProperty(aT,ac(bz,bn));this.doLayout(true);this.fireEvent(e,["deleteRow",bl,bt]);return bt;};aq.prototype.insertCol=function(br,bs,bv){bs=parseInt(bs)||1;if(bs<0){return{error:"至少插入一列."};}if(!isArray(bv)){bv=[bv];}var bq=this._property,bw=bq["widths"],bx=bw.length,bm=[],bl=null;for(var bG=0;bG<bs;bG++){var bB=bv[bG];if(bB&&h.test(bB)){bB=-(parseFloat(bB)/100);}else{bB=parseFloat(bB);if(isNaN(bB)||bB<0){bB=bG===0?bq["defwidth"]:bm[0];}}bm[bG]=bB.toRound(2);}br=parseInt(br);if(isNaN(br)||br<0||br>bx){br=bx;}if(this.fireEvent(at,(bl=[br,bs,bm]))===false){return{error:"不满足插入列条件."};}var bn=bq["cells"],bD=bq["heights"].length,bz=bq["gridDom"],bj=bq["onnewcell"],bt=[];if(br===bx){for(var bG=br,bF=bG+bs;bG<bF;bG++){for(var by=0;by<bD;by++){var bE=bd(bz,bj,a9(bn,by,-1,bz));bn[by][bG]={rs:1,cs:1,dom:bE};bt.push({r:by,c:bG,dom:bE,rs:1,cs:1});}}}else{var bk=[],bC=null,bu=null,bi=null,bp=null,bA=null,bE=null;for(var by=0;by<bD;by+=bi[aa]){bi=bn[by][br];if(!bi[ae]){bC={r:(bp=bi[ap]),c:(bA=bi[ax])},bi=bn[bp][bA],bu=bi[aa];bi[a4]+=bs;while(--bu>=0){bk[by+bu]=bC;}}}for(var bG=br,bF=bG+bs;bG<bF;bG++){for(var by=0;by<bD;by++){bi=bk[by];if(!bi){bE=bd(bz,bj,a9(bn,by,bG,bz));bn[by].splice(bG,0,{rs:1,cs:1,dom:bE});bt.push({r:by,c:bG,dom:bE,rs:1,cs:1});}else{bn[by].splice(bG,0,{r:bi[ap],c:bi[ax]});}}}}bw.splice.apply(bw,[br,0].concat(bm));var bo=bq["fixedcols"];w(bo,br,bs);w(bq["stretchedcols"],br,bs);aK(bq["selectrange"],1,br,bs);this.setProperty(aJ,ac(bw,bo));this.doLayout(true);this.fireEvent(e,["insertCol",bl,bt]);return bt;};aq.prototype.deleteCol=function(bp,bq){bp=parseInt(bp);if(isNaN(bp)||bp<0){return{error:"起始删除列不合法."};}bq=parseInt(bq)||1;if(bq<0){return{error:"删除列数不能小于一列."};}var bo=this._property,bt=bo["widths"],bu=bt.length,bl=[];if(bp>=bu){return{error:"起始删除列不合法."};}bq=Math.min(bq,bu-bp);if(bq===bu){return{error:"至少要保留一列."};}if(this.fireEvent(al,bl=[bp,bq])===false){return{error:"不满足删除列条件."};}var bm=bo["cells"],bw=bo["gridDom"],br=[],by=bp+bq;var bz=bo["heights"].length,bk=null,bx=null,bB=null;for(var bv=0;bv<bz;bv+=bk[aa]){bk=bm[bv][bp];if(bk[ae]){continue;}bx=bk[ax],bk=bm[bv][bx];bk[a4]=Math.max(bp-bx,bk[a4]-bq);}if(by<bu){for(var bv=0;bv<bz;bv+=bk[aa]){bk=bm[bv][by];if(!bk[ae]){bx=bk[ax];if(bx<bp){continue;}bk=bm[bv][bx];var bi=a9(bm,bv,bx,bw);bm[bv][by]={dom:bB=bk[ae],rs:bk[aa],cs:bk[a4]-by+bx};bw[bi?"insertBefore":"appendChild"](bB,bi);bk[ae]=null;}var bs=bk[aa];while(--bs){bm[bs+bv][by][ax]=bp;}}for(var bA=by+1;bA<bu;bA++){for(var bv=0;bv<bz;bv+=bk[aa]){bk=bm[bv][bA];if(!bk[ae]){bx=bk[ax];if(bx<bp){continue;}bk=bm[bv][bx];bx=Math.max(bx-bq,bp);}else{bx=bA-bq;}var bs=bk[aa];while(--bs){bm[bs+bv][bA][ax]=bx;}}}}for(var bv=0;bv<bz;bv++){var bj=bm[bv];for(var bA=bp;bA<by;bA++){bk=bj[bA],bB=bk[ae];if(bB){br.push({r:bv,c:bA,dom:bw.removeChild(bB),rs:bk[aa],cs:bk[a4]});}}bj.splice(bp,bq);}bt.splice(bp,bq);var bn=bo["fixedcols"];w(bn,bp,-bq);w(bo["stretchedcols"],bp,-bq);if(aK(bo["selectrange"],1,bp,-bq)===false){this.clearSelection();}this.setProperty(aJ,ac(bt,bn));this.doLayout(true);this.fireEvent(e,["deleteCol",bl,br]);return br;};function t(bn,bk,bp,bm,br){var bl=null,bq=null,bs=null,bj=null;for(var bi=bn;bi<=bp;bi++){bl=br[bi];bq=bl[bk];if(!bq[ae]){bj=bq[ax];if(bj!==bk){return t(bn,bj,bp,bm,br);}}bq=bl[bm];if(!bq[ae]){if(bq[ap]!==bi){continue;}bj=bq[ax];bq=br[bi][bj];}else{bj=bm;}bj=bj+bq[a4]-1;if(bj!==bm){return t(bn,bk,bp,bj,br);}}bl=br[bn];for(var bo=bk;bo<=bm;bo+=bq[a4]){bq=bl[bo];if(!bq[ae]){return t(bq[ap],bk,bp,bm,br);}}bl=br[bp];for(var bo=bk;bo<=bm;bo+=bq[a4]){bq=bl[bo];if(!bq[ae]){bs=bq[ap];bq=br[bs][bq[ax]];}else{bs=bp;}bs=bs+bq[aa]-1;if(bs!==bp){return t(bn,bk,bs,bm,br);}}return[bn,bk,bp,bm];}aq.prototype.getRange=function(bk,bl,bn,bj){bk=parseInt(bk),bl=parseInt(bl);if(isNaN(bk)||isNaN(bl)||bk<0||bl<0){return;}var bm=this._property,bo=bm["heights"].length,bi=bm["widths"].length;if(bk>=bo||bl>=bi){return;}bn=parseInt(bn),bj=parseInt(bj);if(isNaN(bn)||bn<bk||bn>=bo){bn=bo-1;}if(isNaN(bj)||bj<bl||bj>=bi){bj=bi-1;}return t(bk,bl,bn,bj,bm["cells"]);};aq.prototype.mergeCell=function(bm,bE){if(!bm){bm=this.getSelection();}else{if(arguments[2]!==false){bm=this.getRange.apply(this,bm);}}if(!bm){return{error:"无法确定要合并的范围."};}var bn=[bm,bE];if(this.fireEvent(J,bn)===false){return{error:"不满足合并条件."};}var bs=this._property,by=bs["gridDom"],bl=bs["onnewcell"],bo=bs["cells"],bt=[];var bq=bm[0],bz=bm[1],bi=bm[2],bv=bm[3];if(bE===D){var bj=null,bk=null,bD=null,bA=null,bu=null,bC=null,bw=bv-bz+1;for(var bx=bq;bx<=bi;){bj=bo[bx],bk=bj[bz],bC={r:bx,c:bz,dom:bk[ae],rs:(bu=bk[aa]),cs:bk[a4]};while(bu--){for(var bB=bz+1;bB<=bv;bB++){bk=bj[bB],bA=bk[ae];bj[bB]={r:bx,c:bz};if(bA){if(bC===null){bC={r:bx,c:bB,dom:bk[ae],rs:bk[aa],cs:bk[a4]};}else{if(!bD&&bA.childNodes.length>0){bD=bC[ae];if(bD.childNodes.length===0){bt.push(bC);by.insertBefore(bA,bD);by.removeChild(bD);bD=bA;continue;}}bt.push({r:bx,c:bB,dom:by.removeChild(bA),rs:bk[aa],cs:bk[a4]});}}}if(bC){if(!bD){bD=bC[ae];}bC=null;}else{bD=bd(by,bl,a9(bo,bx,bz,by));}bj[bz]={dom:bD,rs:1,cs:bw};bD=null;bj=bo[++bx];}}}else{if(bE===G){var bj=bo[bq],bk=null,bD=null,bA=null,bp=null,bC=null,br=bi-bq+1;for(var bB=bz;bB<=bv;){bk=bj[bB],bC={r:bq,c:bB,dom:bk[ae],rs:bk[aa],cs:(bp=bk[a4])};while(bp--){for(var bx=bq+1;bx<=bi;bx++){bk=bo[bx][bB],bA=bk[ae];bo[bx][bB]={r:bq,c:bB};if(bA){if(bC===null){bC={r:bx,c:bB,dom:bk[ae],rs:bk[aa],cs:bk[a4]};}else{if(!bD&&bA.childNodes.length>0){bD=bC[ae];if(bD.childNodes.length===0){bt.push(bC);by.insertBefore(bA,bD);by.removeChild(bD);bD=bA;continue;}}bt.push({r:bx,c:bB,dom:by.removeChild(bA),rs:bk[aa],cs:bk[a4]});}}}if(bC){if(!bD){bD=bC[ae];}bC=null;}else{bD=bd(by,bl,a9(bo,bq,bB,by));}bj[bB++]={dom:bD,rs:br,cs:1};bD=null;}}}else{var bj=null,bD=null,bC=null;for(var bx=bq;bx<=bi;bx++){bj=bo[bx];for(var bB=bz;bB<=bv;bB++){bk=bj[bB],bA=bk[ae];bj[bB]={r:bq,c:bz};if(bA){if(bC===null){bC={r:bx,c:bB,dom:bk[ae],rs:bk[aa],cs:bk[a4]};}else{if(!bD&&bA.childNodes.length>0){bD=bC[ae];if(bD.childNodes.length===0){bt.push(bC);by.removeChild(bD);bD=bA;continue;}}bt.push({r:bx,c:bB,dom:by.removeChild(bA),rs:bk[aa],cs:bk[a4]});}}}}bo[bq][bz]={dom:bD||bC[ae],rs:bi-bq+1,cs:bv-bz+1};}}this.fireEvent(e,["mergeCell",bn,bt]);this.doLayout();return bt;};function aj(bo,bt){var bk=[],bp=bo[0],bj=bo[1],br=bo[2],bm=bo[3],bl=null,bs=null,bn=null;for(var bi=bp;bi<=br;bi++){bl=bt[bi];if(!bl){break;}for(var bq=bj;bq<=bm;bq++){bs=bl[bq],bn=bs[ae];if(!bn){continue;}bk.push({dom:bn,r:bi,c:bq,rs:bs[aa],cs:bs[a4]});}}return bk;}aq.prototype.splitCell=function(br,bG){if(!br){br=this.getSelection();if(!br){return{error:"无法确定要拆分的范围."};}}var bq=this._property,bm=bq["cells"];if(br.length===4&&!isNaN(br[0])){br=aj(br,bm);}var bl=[br,bG];if(this.fireEvent(aE,bl)===false){return{error:"不满足拆分条件."};}var bx=bq["gridDom"],bk=bq["onnewcell"],bs=[],bE=null,bi=null,bj=null,bp=null,bo=null,bu=null,bn=null,bt=null,bC=null;if(bG===D){for(var bz=0,bB=br.length;bz<bB;bz++){bE=br[bz];bp=bE[ap],bo=bE[ax],bu=bE[aa],bn=bE[a4],bt=bE["num"];if(bt===undefined){bi=bm[bp];bi[bo][a4]=1;for(var bF=bo+1,bv=bF+bn;bF<bv;bF++){bi[bF]={dom:(bC=bd(bx,bk,a9(bm,bp,bF))),rs:bu,cs:1};bs.push({dom:bC,rs:bu,cs:1,r:bp,c:bF,or:bp,oc:bo});for(var bw=bp+1,by=bp+bu;bw<by;bw++){bm[bw][bF][ax]=bF;}}}else{if(bn>bt){bi=bm[bp];bi[bo][a4]=bt;var bA=bo+bt;bi[bA]={dom:(bC=bd(bx,bk,a9(bm,bp,bA))),rs:bu,cs:bn-bt};bs.push({dom:bC,rs:bu,cs:bn-bt,r:bp,c:bA,or:bp,oc:bo});for(var bw=bp,by=bp+bu;bw<by;bw++){bi=bm[bw];for(var bF=(bw===bp?bA+1:bA),bv=bo+bn;bF<bv;bF++){bi[bF][ax]=bA;}}}}}}else{if(bG===G){for(var bz=0,bB=br.length;bz<bB;bz++){bE=br[bz];bp=bE[ap],bo=bE[ax],bu=bE[aa],bn=bE[a4],bt=bE["num"];if(bt===undefined){bi=bm[bp];bi[aa]=1;for(var bw=bp+1,by=bp+bu;bw<by;bw++){bi=bm[bw];bi[bo]={dom:(bC=bd(bx,bk,a9(bm,bw,bo))),rs:1,cs:bn};bs.push({dom:bC,rs:1,cs:bn,r:bw,c:bo,or:bp,oc:bo});for(var bF=bo+1,bv=bo+bn;bF<bv;bF++){bi[bF][ap]=bw;}}}else{if(bu>bt){bm[bp][bo][aa]=bt;var bD=bp+bt;bm[bD][bo]={dom:(bC=bd(bx,bk,a9(bm,bD,bo))),rs:bu-bt,cs:bn};bs.push({dom:bC,rs:bu-bt,cs:bn,r:bD,c:bo,or:bp,oc:bo});for(var bw=bD,by=bp+bu;bw<by;bw++){bi=bm[bw];for(var bF=(bw===bp?bo+1:bo),bv=bo+bn;bF<bv;bF++){bi[bF][ap]=bD;}}}}}}else{for(var bz=0,bB=br.length;bz<bB;bz++){bE=br[bz];bp=bE[ap],bo=bE[ax],bu=bE[aa],bn=bE[a4];for(var bw=bp,by=bp+bu;bw<by;bw++){bi=bm[bw];for(var bF=(bw===bp?bo+1:bo),bv=bo+bn;bF<bv;bF++){bi[bF]={dom:(bC=bd(bx,bk,a9(bm,bw,bF))),rs:1,cs:1};bs.push({dom:bC,rs:1,cs:1,r:bw,c:bF,or:bp,oc:bo});}}bj=bm[bp][bo];bj[aa]=bj[a4]=1;}}}this.fireEvent(e,["splitCell",bl,bs]);this.doLayout(true);return bs;};aq.prototype.separateRow=function(bp,bu){bp=parseInt(bp);if(isNaN(bp)||bp<0){return;}var bq=this._property,bz=bq["heights"],by=bz.length;if(bp>=by){return;}var bm=bz[bp],bv=null,bk=null;if(bu==undefined){bv=(bm/2).toRound(2);}else{bu=parseFloat(bu);if(isNaN(bu)||bu<0){return;}var bo=bq["layoutstatus"][3][bp];if(bu>=bo){return;}bv=(bu/bo*bm).toRound(2);}if(this.fireEvent(az,(bk=["seperateRow",bp,bv]))===false){return;}bz[bp]=(bm-bv).toRound(2);bz.splice(bp,0,bv);var bl=bq["cells"],bs=bq["widths"].length,bi=bl[bp],bw=[],bj=null,br=null,bn=null;for(var bA=0;bA<bs;bA+=bn){bj=bi[bA];if(bj[ae]){br=bp;}else{br=bj[ap];bj=bl[br][bA];}bj[aa]+=1;bn=bj[a4];for(var bx=0;bx<bn;bx++){bw.push({r:br,c:bA});}}for(var bt=bp+1;bt<by;bt++){bi=bl[bt];for(var bA=0;bA<bs;bA++){bj=bi[bA];if(!bj[ae]&&bj[ap]>bp){bj[ap]+=1;}}}bl.splice(bp+1,0,bw);aK(bq["selectrange"],0,bp,0);this.fireEvent(Z,bk);};aq.prototype.separateCol=function(bm,bv){bm=parseInt(bm);if(isNaN(bm)||bm<0){return;}var bo=this._property,br=bo["widths"],bs=br.length;if(bm>=bs){return;}var bw=br[bm],bn=null,bk=null;if(bv==undefined){bn=(bw/2).toRound(2);}else{bv=parseFloat(bv);if(isNaN(bv)||bv<0){return;}var bq=bo["layoutstatus"][2][bm];if(bv>=bq){return;}bn=(bv/bq*bw).toRound(2);}if(this.fireEvent(az,(bk=["seperateCol",bm,bn]))===false){return;}br[bm]=(bw-bn).toRound(2);br.splice(bm,0,bn);var bl=bo["cells"],bx=bl.length,bi=null,bj=null,bu=null,bp=null;for(var bt=0;bt<bx;bt+=bp){bi=bl[bt],bj=bi[bm];if(bj[ae]){bu=bm;}else{bu=bj[ax];bj=bi[bu];}bj[a4]+=1;bp=bj[aa];for(var by=0;by<bp;by++){bi=bl[bt+by];for(var bz=bm+1;bz<bs;bz++){bj=bi[bz];if(!bj[ae]&&bj[ax]>bm){bj[ax]+=1;}}bi.splice(bm+1,0,{r:bt,c:bu});}}aK(bo["selectrange"],1,bm,0);this.fireEvent(Z,bk);};var aV="col-resize",a3="row-resize";var aR=20,bc=5;function n(bj,bl,bm,bi){if(bj>bm){var bk=bj;bj=bm;bm=bk;}if(bl>bi){var bk=bl;bl=bi;bi=bk;}return this.getRange(bj,bl,bm,bi);}function O(bi,bj){if(!bi||!bj){return false;}return bi[0]===bj[0]&&bi[1]===bj[1]&&bi[2]===bj[2]&&bi[3]===bj[3];}function aA(bm,bp,bo,bn,bj){if(bn>bj){return null;}var bk=Math.floor((bn+bj)/2),bl=bm[bk];if(bp<bl-bo-1){return aA(bm,bp,bo,bn,bk-1);}if(bp>bl+1){return aA(bm,bp,bo,bk+1,bj);}var bi=bm.length-1;if(bk==0||bk==bi){return null;}return{index:bk-1,current:bm[bk],min:bm[bk-1]+bo,max:bm[bi]-2*bo};}var A=null,ar=null;function Q(bj,bi){if(!A){bi=bi||document;A=bi.body.appendChild(bi.createElement("div"));A.style.cssText+="; position: absolute; width: 0; height: 0; border: none; background-color: #AECAF7; z-index: 10000;";}A.style.cssText+=bj;return A;}function aH(bk,bi){var bj=bk.getProperty("shadeDom");if(!bj){bj=bk.getGridDom().appendChild(bk.doc.createElement("div"));bj.style.cssText+="; position: absolute; left: 0; top: 0; right: 0; bottom: 0; background: url(xui/images/null.gif); z-index: 10000;";bk.setProperty("shadeDom",bj);}bj.style.display=bi?"":"none";}function C(by,bu,bw){if(arguments.length<=1){if(ar){ar.style.display="none";}return;}if(!ar){var bz=by.doc;ar=bz.body.appendChild(bz.createElement("div"));disableDocTextSelect(ar);ar.className="cursor_draw";ar.style.cssText+="; position: absolute; border: 1px dashed #666; border-right: none; border-bottom: none; z-index: 10000;";}var br=bu["range"],bt=bu["checkedrange"],bv=null;if(!bt){bu["lastrc"]=[br[2],br[3]];var bk=by.getGridDom().getBoundingClientRect();bu["offsetX"]=bk.left;bu["offsetY"]=bk.top;bu["ishorizon"]=bw;bt=bu["checkedrange"]=n.apply(by,br);bv="; display: block; ";}else{var bq=true,bj=bu["lastrc"],bi=br[2],bo=br[3];if(bj[0]!==bi||bj[1]!==bo){bu["lastrc"]=[bi,bo];var bl=n.apply(by,br);if(!(bq=O(bl,bt))){bt=bu["checkedrange"]=bl;}}if(bq&&bw===bu["ishorizon"]){return;}bu["ishorizon"]=bw;}if(bw){var bn=by._property,bx=bn["layoutstatus"][4],bm=bx[bt[1]];bv=(bv||"")+"; left: "+(bm+bu["offsetX"])+"px; top: "+bu["startY"]+"px; width: "+(bx[bt[3]+1]-bm-bn["hgap"])+"px; height: 1px;";}else{var bn=by._property,bp=bn["layoutstatus"][5],bs=bp[bt[0]];bv=(bv||"")+"; left: "+bu["startX"]+"px; top: "+(bs+bu["offsetY"])+"px; width: 1px; height: "+(bp[bt[2]+1]-bs-bn["vgap"])+"px;";}ar.style.cssText+=bv;}var ad=1,a2=2,y=4,c=8,N=null;function bb(bi){if(!bi||!bh(bi)){N=null;}}function bh(bi){return N&&N["layout"]!==bi;}function aM(bj,bi,bm){var bl=bi.getGridDom(),bk=null;while(bj!==bl){bk=bj;bj=bj.parentNode;}if(bk&&bm!==bk){return bi.getCell(bk);}return false;}function ay(bk){var bo=bk.data;if(bh(bo)){return;}var bp=bo._property;if(bp["enabledrawsplit"]){if(bk.which===3){return;}var bi=aM(bk.target,bo);if(!bi){return;}var bj=bi[ap],bm=bi[ax];N={layout:bo,state:y,startX:bk.pageX,startY:bk.pageY,lastcelldom:bi[ae],range:[bj,bm,bj,bm]};}else{if(N){if(bk.which===3){return;}N["state"]|=y;aH(bo,true);}else{if(bp["enableselect"]){var bi=aM(bk.target,bo);if(!bi){return;}var bj=bi[ap],bm=bi[ax];if(bk.which===3){var bn=bp["selectrange"];if(bn&&bn[0]<=bj&&bn[1]<=bm&&bn[2]>=bj&&bn[3]>=bm){N={layout:bo};bo.fireEvent(L,[bk,bj,bm]);return;}}var bl=[bj,bm,bj,bm];N={layout:bo,state:y,startX:bk.pageX,startY:bk.pageY,lastcelldom:bi[ae],range:bl};bo.setSelection(bl);}else{return;}}}$(bo.doc).bind("mouseup.layout",bo,a0).bind("mouseleave.layout",bo,aO);}function j(br){var bo=br.data;if(bh(bo)){return;}var bq=bo._property;if(bq["enabledrawsplit"]){if(N){var bi=N["state"];var bm=br.pageX,bk=br.pageY,bj=Math.abs(bm-N["startX"]),bs=Math.abs(bk-N["startY"]);if(bi===y){if(bj<=bc&&bs<=bc){return;}N["state"]|=c;}var bp=aM(br.target,bo,N["lastcelldom"]);if(bp){N["lastcelldom"]=bp[ae];N["range"].splice(2,2,bp[ap],bp[ax]);}C(bo,N,bj>=bs);}}else{if(N){var bi=N["state"];if(bi>=y){if(bi%y!==0){var bl=N["evtname"];if(bi>c){Q(N["barcssprefix"]+Math.max(Math.min(br[bl]+N["baroffset"],N["maxpos"]),N["minpos"])+"px;");}else{if(Math.abs(br[bl]-N["startpos"])>bc){N["state"]|=c;Q(N["barcssinit"]+N["barcssprefix"]+(br[bl]+N["baroffset"])+"px;",bo.doc);}}}else{var bp=aM(br.target,bo,N["lastcelldom"]);if(bp){N["lastcelldom"]=bp[ae];var bn=N["range"];bn.splice(2,2,bp[ap],bp[ax]);bo.setSelection(bn);}}return;}}if(bq["enablelayout"]){N=x.call(this,br,bq,bo);}}}function aD(bj,bk){var bi=bj.getProperty("_pscrolldom_");if(bi==null){bi=bk||bj.getContainer();while(bi=bi.parentNode){if(getCurrentStyle(bi,"overflow")==="auto"){break;}}bj.setProperty("_pscrolldom_",bi||false);}return bi;}function x(bw,bs,bB){var bC=bw.target;if(bC===this){var bl=this.getBoundingClientRect(),bk=bw.pageX,bi=bw.pageY,bt=bl.left,br=bl.top,bz=bl.right,bo=bl.bottom,by=bs["gap"],bq=bk-bt,bx=bi-br;if(!(bq<=by||bz-bk<=by||bx<=by||bo-bi<=by)){var bA=bs["layoutstatus"][4],bn=bs["hgap"];if(!bA){return;}var bj=aA(bA,bq,bn,0,bA.length-1);if(bj!==null){var bu=aD(bB,this);if(bu){var bm=bu.getBoundingClientRect();br=Math.max(bm.top,br),bo=Math.min(bm.bottom,bo);}return{layout:bw.data,state:ad,index:bj["index"],startpos:bk,curpos:bt+bj["current"],maxpos:bt+bj["max"],minpos:bt+bj["min"],evtname:"pageX",baroffset:-bn/2,barcssprefix:"; left: ",barcssinit:"; display: block; top: "+br+"px; width: "+bn+"px; height: "+(bo-br)+"px; cursor: "+(this.style.cursor=aV)};}var bv=bs["layoutstatus"][5],bp=bs["vgap"];bj=aA(bv,bx,bp,0,bv.length-1);if(bj!==null){var bu=aD(bB,this);if(bu){var bm=bu.getBoundingClientRect();bt=Math.max(bm.left,bt),bz=Math.min(bm.right,bz);}return{layout:bw.data,state:a2,index:bj["index"],startpos:bi,curpos:br+bj["current"],maxpos:br+bj["max"],minpos:br+bj["min"],evtname:"pageY",baroffset:-bp/2,barcssprefix:"; top: ",barcssinit:"; display: block; left: "+bt+"px; height: "+bp+"px; width: "+(bz-bt)+"px; cursor: "+(this.style.cursor=a3)};}}}if(N){this.style.cursor="";}}function a0(bF){var bU=N["state"];if(bU%y!==0){if(bU>c){var bv=null,bs=N["minpos"],by=N["curpos"],bE=Math.max(Math.min(bF[N["evtname"]]+N["baroffset"],N["maxpos"]),bs);if(by!==bE){var bH=bF.data,bB=by-bs,bT=bE-bs,bQ=N["index"],bS=null;if((bU&ad)===ad){bv=bH._property["widths"];bS=D;}else{bv=bH._property["heights"];bS=G;}var bm=[],bA=bv.concat(),bo=bv[bQ];if(bo>=0){bm.push(bQ);bv[bQ]=(bo*bT/bB).toRound(2);}else{var bI=bT/bB;for(var bP=0,bw=bv.length;bP<bw;bP++){bo=bv[bP];if(bo>=0){bm.push(bP);bv[bP]=(bo*bI).toRound(2);}}}bH.fireEvent(B,[bv.concat(),bA,bm,bS]);R(bH);}}}else{if(bU>y){var bH=bF.data,bN=bH._property,bx=bN["cells"],bM=[],bD=null;if(N["ishorizon"]){bD=G;var bL=bH.getRowByPoint(N["startY"]-N["offsetY"]),bu=bL[0],bl=bL[1].toRound(2),bO=null;if(bl<aR){bO=bu;}else{bO=bu+1;if(bL[2]>=aR){bH.separateRow(bu,bl);}}var br=N["checkedrange"],bj=bx[bu],bC=null,bk=null,bK=null,bz=null;for(var bR=br[1],bi=br[3];bR<=bi;bR+=bz){bC=bj[bR],bk=bC[ae];if(!bk){bK=bC[ap];bC=bx[bK][bR];}else{bK=bu;}if(bO>bK){bM.push({dom:bk||bC[ae],r:bK,c:bR,rs:bC[aa],cs:(bz=bC[a4]),num:bO-bK});}}}else{bD=D;var bq=bH.getColByPoint(N["startX"]-N["offsetX"]),bp=bq[0],bt=bq[1].toRound(2),bJ=null;if(bt<aR){bJ=bp;}else{bJ=bp+1;if(bq[2]>=aR){bH.separateCol(bp,bt);}}var br=N["checkedrange"],bC=null,bk=null,bR=null,bG=null;for(var bK=br[0],bn=br[2];bK<=bn;bK+=bG){bC=bx[bK][bp],bk=bC[ae];if(!bk){bR=bC[ax];bC=bx[bK][bR];}else{bR=bp;}if(bJ>bR){bM.push({dom:bk||bC[ae],r:bK,c:bR,rs:(bG=bC[aa]),cs:bC[a4],num:bJ-bR});}}}bH.splitCell(bM,bD);if(bN["drawsplitonce"]){bH.enableDrawSplit(false);}}}aO.call(this,bF,false);}function aO(bi){var bk=N["state"];if(bk>=y){$(this).unbind("mouseup.layout mouseleave.layout");if(bk%y!==0){var bj=bi.data;bj.getGridDom().style.cursor="";aH(bj,false);Q("; display: none;");}else{if(bk>y){C(bi.data);}}}N=null;}function au(){var bj=this._property,bi=bj["enablelayout"]||bj["enableselect"]||bj["enabledrawsplit"];if(!bj["__evtbinded__"]){if(bi){$(bj["gridDom"]).bind("mousedown.layout",this,ay).bind("mousemove.layout",this,j);bj["__evtbinded__"]=true;}}else{if(!bi){$(bj["gridDom"]).unbind(".layout");bj["__evtbinded__"]=false;}}}aq.prototype.enableLayout=function(bi){bi=bi!==false;var bj=this._property;if(bj["enablelayout"]===bi){return;}bj["enablelayout"]=bi;this.fireEvent(a5,[bi]);au.call(this);};aq.prototype.enableSelect=function(bi){bi=bi!==false;var bj=this._property;if(bj["enableselect"]===bi){return;}bj["enableselect"]=bi;this.fireEvent(u,[bi]);au.call(this);};aq.prototype.enableDrawSplit=function(bi){bi=bi!==false;var bj=this._property;if(bj["enabledrawsplit"]===bi){return;}bj["enabledrawsplit"]=bi;bi?addClassName(bj["gridDom"],"cursor_draw"):removeClassName(bj["gridDom"],"cursor_draw");this.fireEvent(p,[bi]);au.call(this);};function d(bi,bj){bj.push(bi[ae]);}aq.prototype.getSelection=function(){var bj=this._property["selectrange"];if(!bj){return;}if(arguments[0]===ae){var bi=[];this.browseCells(d,bi,bj);return bi;}return bj.concat();};var q=null,g=null;var aC=2;function H(bm,bk){if(!q){var bj=bm.doc.createElement("div");bj.style.cssText+="; position: absolute; width: "+aC+"px; height: "+aC+"px; border: none; background-color: #7373FF; z-index: 998";bj.className="layoutSelectionLine";q=[bj,bj.cloneNode(false),bj.cloneNode(false),bj.cloneNode(false)];}if(g!==bm){if(g){g.clearSelection();}var bo=bm.getGridDom();for(var bl=0,bi=q.length;bl<bi;bl++){bo.appendChild(q[bl]);}}var bn=bm._property;aQ(bk,bn["layoutstatus"][4],bn["layoutstatus"][5],bn["hgap"],bn["vgap"]);g=bm;}function aQ(bm,bs,bp,bn,bt){var bk=[],bq=[];if(bs){var bj=bs[bm[1]],bi=bs[bm[3]+1]-bj-bn;bk[0]=bk[2]="; left: "+bj+"px; width:"+bi+"px;";bk[1]="; left: "+(bj+bi-aC)+"px;";bk[3]="; left: "+bj+"px;";}if(bp){var bo=bp[bm[0]],br=bp[bm[2]+1]-bo-bt;bq[0]="; top:"+bo+"px;";bq[1]=bq[3]="; top:"+bo+"px; height: "+br+"px;";bq[2]="; top:"+(bo+br-aC)+"px;";}for(var bl=0;bl<4;bl++){q[bl].style.cssText+=(bk[bl]||"")+(bq[bl]||"");}}function aI(){if(g){var bk=g.getGridDom();for(var bj=0,bi=q.length;bj<bi;bj++){bk.removeChild(q[bj]);}g=null;}}aq.prototype.setSelection=function(bi){if(arguments.length<1){return this.clearSelection();}if(arguments[1]!==false){bi=n.apply(this,bi);if(!bi){return this.clearSelection();}}var bk=this._property,bj=bk["selectrange"];if(O(bj,bi)){return;}H(this,bk["selectrange"]=bi);this.fireEvent(m,[bi.concat(),bj]);};aq.prototype.clearSelection=function(){var bj=this._property,bi=bj["selectrange"];if(!bi){return;}bj["selectrange"]=null;aI();this.fireEvent(r,[bi]);};function b(){R(this);}aq.prototype.doLayout=function(bk){var bj=this._property;if(bj["timeout_dolayout"]){clearTimeout(bj["timeout_dolayout"]);}if(bk===true){var bi=bj["doLayoutBind"];if(!bi){bi=bj["doLayoutBind"]=b.bind(this);}bj["timeout_dolayout"]=setTimeout(bi,100);}else{bj["timeout_dolayout"]=false;return b.call(this);}};aq.prototype.setProperty=function(bi,bk){if(!bi){return;}var bj=this._property,bm=bi.ensureStartWith(ba),bl=bj[bm];if(bk===bl){return;}if(bk==null){delete bj[bm];}else{bj[bm]=bk;}this.fireEvent(ai,[bi,bk,bl]);};aq.prototype.getProperty=function(bi){return bi?this._property[bi.ensureStartWith(ba)]:null;};function bd(bm,bk,bj){var bi=null,bl=bm.ownerDocument;if(bk){bi=bk(bm,bl);}if(!bi){bi=bl.createElement("div");bi.style.border="1px solid #CCC";}bm[bj?"insertBefore":"appendChild"](bi,bj).style.position="absolute";return bi;}function I(bl){if(!bl){return[-1];}var bk=[],bi=bl.length,bn=[];for(var bm=0;bm<bi;bm++){var bj=bl[bm];if(h.test(bj)){bn.push(bm);bk[bm]=-(parseFloat(bj)/100).toRound(2);}else{bk[bm]=(parseFloat(bj)||0).toRound(2);}}return bk;}function ac(bs,bi){var bu=0,bq=0,bj=0,br=0,bn=bs.length,bl=0;for(var bk=0;bk<bn;bk++){var bt=bi.indexOf(bk);if(bs[bk]>=0){if(bt===-1){br=2;}else{bj=1;}}else{if(bt===-1){bu=2;}else{bq=1;}bl-=bs[bk];}}if(bj+br===0){if(bl!==1){if(bl===0){var bp=-(1/bn).toRound(2);for(var bk=1;bk<bn;bk++){bs[bk]=bp;}bs[0]=1+bp*(bn-1);}else{var bo=1/bl,bt=bn-1,bm=0;for(var bk=0;bk<bt;bk++){bm-=(bs[bk]=(bs[bk]*bo).toRound(2));}bs[bt]=bm-1;}}}else{if(bl>=1){var bo=1/(Math.floor(bl)+1),bm=0;for(var bk=0;bk<bn;bk++){if(bs[bk]<0){bm-=(bs[bk]=(bs[bk]*bo).toRound(2));}}}}return"N"+(bj+br)+"P"+(bq+bu);}function F(bw,by,bm){var bo=[],bn=null;if(!bw){for(var bi=0;bi<by;bi++){bn=bo[bi]=[];for(var bt=0;bt<bm;bt++){bn[bt]={rs:1,cs:1};}}}else{var bj=null,bk=null,bp=null,br=null,bs={rs:1,cs:1};for(var bi=0;bi<by;bi++){bj=bw[bi]||[];bn=bo[bi]=bo[bi]||[];for(var bt=0;bt<bm;bt+=br){if(bn[bt]){br=1;continue;}bk=bj[bt]||bs,bp=bk[aa]||1,br=bk[a4]||1;bn[bt]={rs:bp,cs:br};if(bp>1||br>1){for(var bq=bi,bv=bi+bp;bq<bv;bq++){var bx=bo[bq]=bo[bq]||[];for(var bl=bq===bi?bt+1:bt,bu=bt+br;bl<bu;bl++){if(bx[bl]){throw new Error("布局容器合并行列信息有误，无法正确解析.");}bx[bl]={r:bi,c:bt};}}}}}}return bo;}function Y(bm,br,bs){var bn=bm.firstChild,bl=null,bj=null,bk=null;for(var bi=0,bq=br.length;bi<bq;bi++){bj=br[bi];for(var bo=0,bp=bj.length;bo<bp;bo++){bk=bj[bo];if(bk[aa]){while(bl=bn){bn=bl.nextSibling;if(bl.nodeType!==1||bl.nodeName.toLowerCase()!=="div"){bm.removeChild(bl);continue;}bl.style.position="absolute";bl.style.width="";bl.style.height="";break;}bk[ae]=bl||bd(bm,bs,false);}}}while(bl=bn){bn=bl.nextSibling;bm.removeChild(bl);}if(["relative","absolute"].indexOf(getCurrentStyle(bm,"position"))===-1){bm.style.position="relative";}}function aL(br,bq,bm){var bl=br.appendChild(br.ownerDocument.createElement("div"));bl.style.position="relative";var bj=null,bk=null;for(var bi=0,bp=bq.length;bi<bp;bi++){bj=bq[bi];for(var bn=0,bo=bj.length;bn<bo;bn++){bk=bj[bn];if(bk[aa]){bk[ae]=bd(bl,bm,false);}}}return bl;}function X(bm,bj){var bk=[];if(bm){for(var bl=0,bi=bm.length;bl<bi;bl++){var bn=parseInt(bm[bl]);if(isNaN(bn)||bn<0||bn>bj||bk.indexOf(bn)!==-1){continue;}bk.push(bn);}}return bk;}var ab=[];function T(bk){if(!isNaN(bk)){return ab[bk];}if(!bk||bk.nodeType!==1){return null;}for(var bj=0,bi=ab.length;bj<bi;bj++){if(ab[bj].getGridDom()===bk){return ab[bj];}}return null;}function s(bk){if(!bk){return null;}for(var bj=0,bi=ab.length;bj<bi;bj++){if(ab[bj].getGridDom().parentNode===bk){return ab[bj];}}return null;}function a1(bi){return bi==="N0P1";}function V(bi){return bi.charAt(1)==="1";}function a(bl,bn,bj,bm){var bi=bl.length-1,bk=bl[bi];while(bi<bn){bk=bl[bi+1]=(bk+bj[bi]+bm).toRound(2);bi++;}return bl[bn];}function aF(bj,bo,bn,bl){var bm={from:bo,to:bn,size:bl};for(var bk=0,bi=bj.length;bk<bi;bk++){if(bj[bk]["to"]>=bn){bj.splice(bk,0,bm);return;}}bj.push(bm);}function aW(bk,bi){var bj=["border-top-width","border-right-width","border-bottom-width","border-left-width"];return(parseInt(getCurrentStyle(bk,bj[bi]))||0)+(parseInt(getCurrentStyle(bk,bj[bi+2]))||0);}function aU(bk,bi){var bj=["padding-top","padding-right","padding-bottom","padding-left"];return(parseInt(getCurrentStyle(bk,bj[bi]))||0)+(parseInt(getCurrentStyle(bk,bj[bi+2]))||0);}function a7(bk,bi){var bj=null;if(bi){bj=bk.clientWidth;if(bj<=0){bj=(parseInt(getCurrentStyle(bk,"width"))||0)-aW(bk,1);}bj-=aU(bk,1);}else{bj=bk.offsetWidth;if(bj<=0){bj=parseInt(getCurrentStyle(bk,"width"))||0;}}return bj;}function aB(bk,bj){var bi=null;if(bj){bi=bk.clientHeight;if(bi<=0){bi=(parseInt(getCurrentStyle(bk,"height"))||0)-aW(bk,0);}bi-=aU(bk,0);}else{bi=bk.offsetHeight;if(bi<=0){bi=parseInt(getCurrentStyle(bk,"height"))||0;}}return bi;}function o(bl){var bj=[],bk="display",bi="none";while(bl&&bl.nodeType===1){if(bi===getCurrentStyle(bl,bk)){bj.push({dom:bl,disp:bl.style.display});bl.style.display="block";}bl=bl.parentNode;}return bj;}function ag(bl){if(!bl){return;}for(var bk=0,bi=bl.length;bk<bi;bk++){var bj=bl[bk];bj[ae].style.display=bj["disp"];}return true;}function aX(bi,bk){var bj=bi["dom"];bk.push(bj.style.overflow);bj.style.overflow="hidden";}function an(bm){if(!bm){return[0];}if(isArray(bm)){var bj=[parseInt(bm[0])||0],bk=null;for(var bl=1,bi=bm.length;bl<bi;bl++){bk=parseInt(bm[bl]);bj[bl]=isNaN(bk)||bk<0?-1:bk;}return bj;}return[parseInt(bm)||0];}function am(bn,bj,bm){var bl=-1;for(var bk=bj+1,bi=Math.min(bn.length,bk+bm);bk<bi;bk++){bl=Math.max(bl,bn[bk]);}return bl===-1?bn[0]:bl;}function v(bo,bi,bk){var bj=s(bo),bp=aW(bo,1);if(bj){return R(bj,bi-bp,false)+bp;}else{bo.style.width="1px";var bm=null;if(ieVersion<=8){var bn=bo.scrollLeft,bl=bo.scrollTop;bo.style.position="relative";bm=bo.scrollWidth;bo.style.position="absolute";bo.scrollLeft=bn;bo.scrollTop=bl;}else{bm=bo.scrollWidth;}bi=Math.max(bm+bp+bk,bi);bo.style.width="";return bi;}}function aZ(bk,bs,bj,br,bo,bp){for(var bi=0,bn=bs.length;bi<bn;bi++){var bq=bs[bi][bk],bl=bq[ae];if(!bl){continue;}var bm=bq[a4];if(bm>1){aF(br,bk,bk+bm,v(bl,bj,am(bp,bk,bm))-bo*(bm-1));}else{bj=v(bl,bj,am(bp,bk,1));}}return bj;}function aP(bD,bz,bl,bH,bB,bR,by,bI,bF,bq,bk){var bm=[],bJ=[],bi=null,bN=[],bn=bD,bp=0,bO=[];for(var bK=0,bx=bl.length;bK<bx;bK++){if(bH[bK]!==undefined){continue;}bi=bl[bK];if(bi>=0){bm.push(bK);bp+=(bi=Math.max(bF,bi));bD+=(bH[bK]=aZ(bK,bz,bi,bJ,bq,bk));if(by.indexOf(bK)!==-1){bO.push(bK);}}else{bI=Math.max(bI,aZ(bK,bz,bF,bJ,bq,bk)/(-bi));bB.push(bK);bR-=(bH[bK]=bi);}bN[bK]=true;}var bC=1-bR;bD=Math.ceil(bD===0?bI:bD/bC);for(var bK=0,bx=bJ.length;bK<bx;bK++){var bt=bJ[bK],bu=bt["from"],bQ=bt["to"],bo=0,bE=0,bP=null;while(--bQ>=bu){bi=bH[bQ];if(bi>=0){bE+=bi;}else{bo-=bi;}if(bP===null&&bN[bQ]){bP=bQ;}}bi=Math.ceil(bt["size"]-bE-bD*bo);if(bi>0){if(bH[bP]<0){bi=Math.ceil(bi/(-bH[bP]));}else{bH[bP]+=bi;}bD+=bi;}}if(bD<bI){var bG=bO.length;if(bG>0){var br=(bI-bD)*bC,bs=Math.ceil(br/bG);bH[bO[0]]+=Math.ceil(br-bs*(bG-1));for(var bK=1;bK<bG;bK++){bH[bO[bK]]+=bs;}}else{if(bp===0){var bv=bI*bC-bn,bG=bm.length,bx=bG-1,bs=Math.ceil(bv/bG);for(var bK=bx-1;bK>=0;bK--){bH[bm[bK]]=bs;}bH[bm[bx]]=Math.ceil(bv-bs*bx);}else{var bx=bm.length-1,bv=bI*bC-bn,bj=[],bA=bv,bL=bv/bp;for(var bK=0;bK<bx;bK++){var bP=bm[bK],bM=bj[bK]=bH[bP],bw=bH[bP]=Math.ceil(bl[bP]*bL);if(bw<bM){break;}bA-=bw;}if(bK<bx||bA<bH[bm[bx]]){bL=(bA=bv)/(bD-bn);for(var bK=0;bK<bx;bK++){var bP=bm[bK];bA-=(bH[bP]=Math.ceil((bj[bK]||bH[bP])*bL));}}bH[bm[bx]]=Math.ceil(bA);}}bD=bI;}return bD;}function R(bH,bO,bl){if(bl===false){var bo=bH.getProperty("layouthorizonwidth");if(bo!=null){return bo;}}var bP=bH._property,bi=bP["layoutstatus"],bR=0,bt=arguments.length>2;if(!bl&&bH.fireEvent(aw)===false){var bC=bH.getProperty("prelayout");if(bC){bH.setProperty("prelayout");R(bC);}return bt?bi[bR]:extendObj(true,bi);}if(bP["timeout_dolayout"]){clearTimeout(bP["timeout_dolayout"]);bP["timeout_dolayout"]=false;}var bs=bH.getGridDom();if(!bH.getProperty("parenthiddendoms")){bH.setProperty("parenthiddendoms",o(bs));}if(!bt&&!bH.getProperty("cells_overflow")){var bp=[];bH.browseCells(aX,bp);bH.setProperty("cells_overflow",bp);}var bA=bH.getCell(),bq=bH.getColWidth(),bn=bH.getFixedCols(),bD=bn.length,bu=bH.getGap(0),bT=bH.getGap(1),bv=bH.getProperty(aJ),bG=bP["mincolwidth"];var bJ=[],bF=0,bW=0,bB=[],bj=bq.length,bQ=2*bu+(bj-1)*bT;var by=aW(bs,1);for(var bS=0;bS<bD;bS++){var bU=bn[bS],bM=bq[bU];if(bM>=0){bF+=(bJ[bU]=Math.max(bG,bM));}else{bB.push(bU);bW-=(bJ[bU]=bM);}}if(bH.isHorizonFixed(true)){if(V(bv)){if(bj>bD){for(var bS=0;bS<bj;bS++){if(bJ[bS]!==undefined){continue;}bB.push(bS);bW+=(bJ[bS]=-bq[bS]);}}bF/=(1-bW);}else{bF=aP(bF,bA,bq,bJ,bB,bW,[],0,bG,bT,bP["extwidth"]);}}else{var bL=(bO==null?(a7(bs.parentNode,true)-by):bO)-bQ;if(a1(bv)){bF=bL;}else{bF=aP(bF,bA,bq,bJ,bB,bW,bH.getStretchedCols(),bL,bG,bT,bP["extwidth"]);}if(bl===false){bH.setProperty("layouthorizonwidth",bF=bF+by+bQ);return bF;}bH.setProperty("layouthorizonwidth");}var bz=bB.length;if(bz>0){var bx=-bq[bB[0]],bw=0;for(var bS=1;bS<bz;bS++){var bU=bB[bS],bI=-bq[bU];bx+=bI;bw+=(bJ[bU]=Math.ceil(bI*bF));}bJ[bB[0]]=Math.floor(bF*bx-bw);}bF+=bQ;var bK=[bu],bk=null,bE=null,bm=null;for(var bN=0,br=bA.length;bN<br;bN++){bk=bA[bN];for(var bV=0;bV<bj;bV++){bE=bk[bV],bm=bE[ae];if(!bm){continue;}bm.style.cssText+="; left: "+a(bK,bV,bJ,bT)+"px; right: "+(bF-a(bK,bV+bE[a4],bJ,bT)+bT)+"px;";}}bF=Math.round(bF+by);bP["gridDom"].style.width=bF+"px";bi[bR]=bF;bi[bR+=2]=bJ;bi[bR+=2]=bK;return bt?bF:K(bH);}function a6(bp,bi,bj){var bm=s(bp),bk=aW(bp,0);if(bm){if(!bm.isHorizonFixed(true)){R(bm,null,true);}return K(bm,bi-bk,false)+bk;}else{bp.style.height="1px";var bl=null;if(ieVersion<=8){var bo=bp.scrollLeft,bn=bp.scrollTop;bp.style.position="relative";bl=bp.scrollHeight;bp.style.position="absolute";bp.scrollLeft=bo;bp.scrollTop=bn;}else{bl=bp.scrollHeight;}bi=Math.max(bl+bk+bj,bi);bp.style.height="";return bi;}}function S(bt,bs,br,bl,bo,bq){var bj=bs[bt];for(var bn=0,bm=bj.length;bn<bm;bn++){var bp=bj[bn],bk=bp[ae];if(!bk){continue;}var bi=bp[aa];if(bi>1){aF(bl,bt,bt+bi,a6(bk,br,am(bq,bt,bi))-bo*(bi-1));}else{br=a6(bk,br,am(bq,bt,1));}}return br;}function ak(bx,bw,bH,bI,bz,bR,bN,bv,bP,bo,bG){var bl=[],bi=[],bj=null,bL=[],bF=bx,bQ=0,bA=[];for(var bJ=0,bu=bH.length;bJ<bu;bJ++){if(bI[bJ]!==undefined){continue;}bj=bH[bJ];if(bj>=0){bl.push(bJ);bQ+=(bj=Math.max(bP,bj));bx+=(bI[bJ]=S(bJ,bw,bj,bi,bo,bG));if(bN.indexOf(bJ)!==-1){bA.push(bJ);}}else{bv=Math.max(bv,S(bJ,bw,bP,bi,bo,bG)/(-bj));bz.push(bJ);bR-=(bI[bJ]=bj);}bL[bJ]=true;}var bC=1-bR;bx=Math.ceil(bx===0?bv:bx/bC);for(var bJ=0,bu=bi.length;bJ<bu;bJ++){var br=bi[bJ],bs=br["from"],bO=br["to"],bm=0,bD=0,bM=null;while(--bO>=bs){bj=bI[bO];if(bj>=0){bD+=bj;}else{bm-=bj;}if(bM===null&&bL[bO]){bM=bO;}}bj=Math.ceil(br["size"]-bD-bx*bm);if(bj>0){if(bI[bM]<0){bj=Math.ceil(bj/(-bI[bM]));}else{bI[bM]+=bj;}bx+=bj;}}if(bx<bv){var bE=bA.length;if(bE>0){var bp=(bv-bx)*bC,bq=Math.ceil(bp/bE);bI[bA[0]]+=Math.ceil(bp-bq*(bE-1));for(var bJ=1;bJ<bE;bJ++){bI[bA[bJ]]+=bq;}}else{if(bQ===0){var bt=bv*bC-bF,bE=bl.length,bu=bE-1,bq=Math.ceil(bt/bE);for(var bJ=bu-1;bJ>=0;bJ--){bI[bl[bJ]]=bq;}bI[bl[bu]]=Math.ceil(bt-bq*bu);}else{var bu=bl.length-1,bt=bv*bC-bF,bn=[],by=bt,bK=bt/bQ;for(var bJ=0;bJ<bu;bJ++){var bM=bl[bJ],bk=bn[bJ]=bI[bM],bB=bI[bM]=Math.ceil(bH[bM]*bK);if(bB<bk){break;}by-=bB;}if(bJ<bu||by<bI[bl[bu]]){bK=(by=bt)/(bx-bF);for(var bJ=0;bJ<bu;bJ++){var bM=bl[bJ];by-=(bI[bM]=Math.ceil((bn[bJ]||bI[bM])*bK));}}bI[bl[bu]]=Math.ceil(by);}}bx=bv;}return bx;}function K(bD,br){var bt=arguments[2]===false;if(bt){var bG=bD.getProperty("layoutverticalheight");if(bG!=null){return bG;}}var bK=bD._property,bj=bK["layoutstatus"],bO=1;var bv=bD.getCell(),bM=bD.getRowHeight(),bF=bD.getFixedRows(),bA=bF.length,bo=bD.getGap(0),bH=bD.getGap(2),bp=bD.getProperty(aT),bU=bK["minrowheight"];var bN=[],bx=0,bV=0,bz=[],bm=bM.length,bL=2*bo+(bm-1)*bH;var bn=bD.getGridDom(),bw=aW(bn,0);for(var bQ=0;bQ<bA;bQ++){var bS=bF[bQ],bR=bM[bS];if(bR>=0){bx+=(bN[bS]=Math.max(bU,bR));}else{bz.push(bS);bV+=(bN[bS]=-bR);}}if(bD.isVerticalFixed(true)){if(V(bp)){if(bm>bA){for(var bQ=0;bQ<bm;bQ++){if(bN[bQ]!==undefined){continue;}bz.push(bQ);bV+=(bN[bQ]=-bM[bQ]);}}bx/=(1-bV);}else{bx=ak(bx,bv,bM,bN,bz,bV,[],0,bU,bH,bK["extheight"]);}}else{var bu=(br==null?(aB(bn.parentNode,true)-bw):br)-bL;if(a1(bp)){bx=bu;}else{bx=ak(bx,bv,bM,bN,bz,bV,bD.getStretchedRows(),bu,bU,bH,bK["extheight"]);}if(bt){bD.setProperty("layoutverticalheight",bx=bx+bw+bL);return bx;}bD.setProperty("layoutverticalheight");}var bs=bz.length;if(bs>0){var bq=-bM[bz[0]],bI=0;for(var bQ=1;bQ<bs;bQ++){var bS=bz[bQ],bE=-bM[bS];bq+=bE;bI+=(bN[bS]=Math.ceil(bE*bx));}bN[bz[0]]=Math.floor(bx*bq-bI);}bx+=bL;var bP=[bo],bk=null,bB=null,bl=null,by=bD.getProperty("cells_overflow")||[];bD.setProperty("cells_overflow");for(var bJ=0;bJ<bm;bJ++){bk=bv[bJ];for(var bT=0,bi=bk.length;bT<bi;bT++){bB=bk[bT],bl=bB[ae];if(!bl){continue;}bl.style.cssText+="; top: "+a(bP,bJ,bN,bH)+"px; bottom: "+(bx-a(bP,bJ+bB[aa],bN,bH)+bH)+"px;";bl.style.overflow=by.shift()||"";}}bx=Math.round(bx+bw);bK["gridDom"].style.height=bx+"px";bj[bO]=bx;bj[bO+=2]=bN;bj[bO+=2]=bP;var bC=extendObj(true,bj);bD.browseCells(z);bD.fireEvent(M,bC);if(ag(bD.getProperty("parenthiddendoms"))){bD.setProperty("parenthiddendoms");}return bt?bx:bC;}function z(bi){var bj=s(bi[ae]);if(bj&&!bj.isVerticalFixed(true)){bj.getProperty("layouthorizonwidth")!=null?R(bj):K(bj);}}function aG(bk,bj,bi){var bl=0;for(var bn=Math.max(parseInt(bj)||0,0),bm=Math.min((parseInt(bi)||0)+bn,bk.length);bn<bm;bn++){bl+=bk[bn];}return bl;}function aY(bk,bp,bx,bs,bn,by,bj,bv){if(!bk||!bp||!bx){return;}var bt=bp.length,br=bk.length;if(bs==null||isNaN(bs)||bs<0){bs=0;}if(bn==null||isNaN(bn)||bn<0){bn=bs;}if(by==null||isNaN(by)||by<0){by=bs;}if(bj==null){bj=aG(bk)+bs*2+bn*(br-1);}if(bv==null){bv=aG(bp)+bs*2+by*(bt-1);}var bw=[bs],bq=[bs];for(var bi=0;bi<bt;bi++){var bl=bx[bi];for(var bo=0;bo<br;bo++){var bu=bl[bo],bm=bu[ae];if(!bm){continue;}bm.style.cssText+="; left: "+a(bw,bo,bk,bn)+"px; right: "+(bj-a(bw,bo+bu[a4],bk,bn)+bn)+"px; top: "+a(bq,bi,bp,by)+"px; bottom: "+(bv-a(bq,bi+bu[aa],bp,by)+by)+"px;";}}return[bw,bq];}function E(bm,bj){bj=bj+"px";var bk=bm.cells;for(var bl=0,bi=bk.length;bl<bi;bl++){bk[bl].style.height=bj;}bm.style.height=bj;}function ao(bp,bz){var bi=bp.rows,bv=bi.length,bm=[],bq=[],by=0,bj=0;bz.length=bv;ac(bz=I(bz),[]);for(var bw=0;bw<bv;bw++){var bu=bz[bw];if(bu<0){bq.push(bw);bj-=bu;}else{if(bu===0){bm.push(bw);}else{E(bi[bw],bu);by+=bu;}}}var br=bq.length,bk=bm.length;if(bk>0){var bo=bp.parentNode,bl=0,bB=null;if(bo){var bn=bp.style,bA=bn.height||"";bn.height="1px";bl=aB(bo,true);bn.height=bA;}if(br>0){bl=Math.max(Math.ceil(by/(1-bj)),bl);bB=bl-by;for(var bw=0;bw<br;bw++){var bt=bq[bw],bu=Math.ceil(bl*bz[bt]);E(bi[bt],-bu);bB+=bu;}}else{bB=bl-by;}var bs=Math.ceil(bB/bk),bx=bk-1;for(var bw=0;bw<bx;bw++){E(bi[bm[bw]],bs);}E(bi[bm[bx]],bB-bs*bx);by=bl;}else{if(br>0){var bx=br-1,bl=null,bB=null;if(br===bv){var bo=bp.parentNode;if(bo){var bn=bp.style,bA=bn.height||"";bn.height="1px";bl=aB(bo,true);bn.height=bA;}else{bl=0;}}else{bl=Math.ceil(by/(1-bj));bB=bl-by;}for(var bw=0;bw<bx;bw++){var bt=bq[bw],bu=Math.ceil(bl*bz[bt]);E(bi[bt],-bu);bB+=bu;}E(bi[bq[bx]],bB);by=totalheight;}bp.style.height=by+"px";return by;}}function aS(){this.setProperty("isdoinglayout",true);var bk=this,bj=null,bi=null;while(true){bj=bk.getProperty("parentLayout");if(!bj||bj.getProperty("isdoinglayout")){break;}bi=bj.getCell(bk.getGridDom().parentNode);if(bj.getFixedRows(bi[ap])&&bj.getFixedCols(bi[ax])){break;}bk=bj;}if(bk!==this){this.setProperty("prelayout",bk);return false;}}function i(bi,br,bl,bp,bs,bq){if(!this.isHorizonFixed(true)){var bj=this.getGridDom(),bt=bj.parentNode,bo=null;if(ieVersion<=8){var bk=bt.style.overflow;bt.style.overflow="hidden";bt.getBoundingClientRect();bt.style.overflow=bk||"";bo=a7(bt,true);}else{bo=a7(bt,true);}if(a7(bj,false)!==bo){R(this,bo-aW(bj,1));var bm=this._property["layoutstatus"];bs=bm[4];bq=bm[5];}}this.setProperty("isdoinglayout");this.setProperty("dolayoutcount",(this.getProperty("dolayoutcount")||0)+1);var bn=this.getSelection();if(bn){aQ(bn,bs,bq,this.getGap(1),this.getGap(2));}}function a8(){var bi=ab.indexOf(this);if(bi!==-1){ab.splice(bi,1);var bj=this.getProperty("parentLayout");if(bj){var bk=bj.getProperty("childrenLayout");bk.splice(bk.indexOf(this),1);}ah(this.getGridDom());}}function af(bj){if(arguments.length===2){if(!bj||!/^table$/i.test(bj.tagName)){return;}ao(bj,arguments[1]);}bj=bj||{};if(bj["dofixed"]){return aY(bj["widths"],bj["heights"],bj["cells"],bj["gap"],bj["hgap"],bj["vgap"],bj["width"],bj["height"]);}var bl=bj["ancestordom"];var bn=[];for(var bk=0,bi=ab.length;bk<bi;bk++){var bm=ab[bk];if(!bl||isChildNode(bl,bm.getGridDom(),true)){bm.setProperty("dolayoutcount",0);bn.push(bm);}}for(var bk=0,bi=bn.length;bk<bi;bk++){var bm=bn[bk];if(bm.getProperty("dolayoutcount")===0){R(bm);}}}function P(bi){var bj=bi["dom"].style;bj.width="";bj.height="";}function av(){this.browseCells(P);}function be(bm,bl,bk,bj,bx,bs){var bv=this._property,bw=bv["cells"],bo=null,bu=null,bn=null,bp=bv["hgap"],by=bv["vgap"],br=bv["widths"].length;for(var bi=0,bt=bv["heights"].length;bi<bt;bi++){bo=bw[bi];for(var bq=0;bq<br;bq++){bu=bo[bq],bn=bu[ae];if(bn){bn.style.cssText+="; width: "+(bx[bq+bu[a4]]-bx[bq]-bp-aW(bn,1))+"px; height: "+(bs[bi+bu[aa]]-bs[bi]-by-aW(bn,0))+"px;";}}}}function bg(bi){if(!(ieVersion<8)){return;}bi.attachEvent(aw,av);bi.attachEvent(M,be);}function U(bk){var bm=new aq(bk),bo=bm.getGridDom(),bp=T(bo.parentNode.parentNode);if(bp){bm.setProperty("parentLayout",bp);bp.getProperty("childrenLayout").push(bm);}var bn=null,bj=null;bm.setProperty("childrenLayout",bn=[]);for(var bl=0,bi=ab.length;bl<bi;bl++){bj=ab[bl];if(bj.getGridDom().parentNode.parentNode===bo){bj.setProperty("parentLayout",bm);bn.push(bj);}}bm.attachEvent(aw,aS);bm.attachEvent(M,i);bm.attachEvent(k,a8);bg(bm);ab.push(bm);return bo.layoutobject=bm;}function ah(bk){for(var bi=ab.length-1;bi>=0;bi--){var bj=ab[bi];if(!bk||isChildNode(bk,bj.getGridDom())){bj.setProperty("parentLayout");bj.dispose();ab.splice(bi,1);}}}aN["XGridLayout"]={EVT_ON_LAYOUT:M,EVT_ON_RELAYOUT:aw,EVT_ON_PROPERTY:ai,EVT_ON_INSERT_ROW:f,EVT_ON_DELETE_ROW:bf,EVT_ON_INSERT_COL:at,EVT_ON_DELETE_COL:al,EVT_ON_MERGE_CELL:J,EVT_ON_SPLIT_CELL:aE,EVT_ON_CELL_CHANGE:e,EVT_ON_SELECT_SET:m,EVT_ON_SELECT_CLEAR:r,EVT_ON_SELECT_CONTEXT:L,EVT_ON_SEPARATE_BEFORE:az,EVT_ON_SEPARATE_AFTER:Z,EVT_ON_MOUSE_LAYOUT:B,EVT_ON_ENABLE_LAYOUT:a5,EVT_ON_ENABLE_SELECT:u,EVT_ON_ENABLE_DRAWSPLIT:p,EVT_ON_DISPOSE:k,create:U,getLayout:T,dispose:ah,layout:af};})(window);