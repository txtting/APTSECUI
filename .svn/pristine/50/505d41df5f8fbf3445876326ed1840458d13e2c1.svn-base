<?php
namespace Home\Controller;

class VirController extends CommonController {
    public function index(){
        Layout('Layout/layout');
        $this->display();
    }
    public function indexdata(){
        if(I('post.sign')){
            $n = (int)I('post.sign');
        }else{
            $n = 30;
        }
        $end = time();
        $start = $end -$n*24*3600;
        $data=[];
        $data['data1'] = $this -> indexdata1($start,$end);
        $data['data2'] = $this -> indexdata2($start,$end,'up');
        $data['data3'] = $this -> indexdata2($start,$end,'down');
        $this->ajaxReturn($data);
        //echo json_encode($data);
    }
    public function indexdata1($start,$end){
        $url = 'http://10.80.6.2:8070/byzoro.apt.com/urgencies/list/day?start='.$start.'&end='.$end.'&lastCount=5';
        //发送请求
        $data = request($url,false);
        $data = json_decode($data,true);
        foreach ($data1['data']['Elements'] as $key => &$value) {
            if($value['Time']){
                $value['Time'] = date('Y-m-d H:i:s',$value['Time']);
            }
        }
        return $data['data']['Elements'];
    }
    public function indexdata2($start,$end,$direction){
        //http://byzoro.apt.com/flow/minute
        $url = 'http://10.80.6.2:8070/byzoro.apt.com/flow/minute?start='.$start.'&end='.$end.'&direction='.$direction;
        $data = request($url,false);
        $data = json_decode($data,true);
        $arr = $this -> getindexdata2($data['data']['elements']);
        return $arr;
    }
    public function getindexdata2($arr){
        $str = [];
        foreach($arr as $k => $v){
            $str[$k][0]= (int)$v['time'];
            $str[$k][1]= (int)$v['flow'];
        }
        return $str;
    } 
	public function assets_detail(){  
        Layout('Layout/layout');
        $this->display();
    }
    
}