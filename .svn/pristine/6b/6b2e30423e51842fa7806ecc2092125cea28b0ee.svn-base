<div class="main-content">
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try {
                ace.settings.check('breadcrumbs', 'fixed')
            } catch (e) {
            }
        </script>

        <ul class="breadcrumb">
            <li>
                网元管理
            </li>
            <li class="active">分流器监控</li>
        </ul>
        <!-- .breadcrumb -->

    </div>
    <div class="col-sm-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="formArea marT10">
                    <!--<a href="#" class="more">更多条件</a>-->
                    <form method="post" id="" action="__URL__/index">
                        <p>
                            <input type="hidden" id="ips" value="<?= $_GET['id'] ?>" />
                            <label class="w70 floatLeft" style="line-height:30px; padding-left:5px; width:80px;">查询时间：</label>
                            <div class="input-group w300 floatLeft">
			                    <span class="input-group-addon">
                                    <i class="icon-calendar bigger-110"></i>
			                     </span>
                            <input class="form-control" type="text" name="date-range-picker"
                                   data-date-format="YYYY-MM-DD H:i:s" id="id-datetime"/>
                        </div>

                        <button id="search" class="btn btn-sm btn-primary marL10"><i class="fa fa-search"></i>查询
                        </button>
                        </p>
                        <!--
                        <div class="moreSelect" style="display:none">

                            <p><label class="w70">主机名称：</label><input type="text" name="host"></p>
                        </div>
                        -->

                    </form>
                </div>
                <div style="position: relative">
                    <!--<div style="position: absolute; top: 10px; right: 10px; z-index: 1"><a href="__URL__/flowhistory?id=">查看历史监控</a></div>-->
                    <div class="chartContainer" id="containerA" style=" width:100%;height: 300px; display: block"></div>
                </div>
                <div style="position: relative">
                    <!--<div style="position: absolute; top: 10px; right: 10px; z-index: 1"><a href="__URL__/flowhistory?id=">查看历史监控</a></div>-->
                    <div class="chartContainer" id="containerB" style=" width:100%;height: 300px; display: block"></div>
                </div>
                <div style="clear:both;"></div>
            </div>
            <!-- /.table-responsive -->
        </div>
        <!-- /span -->
    </div>
    <!-- /row -->
</div>


</div>

<script type="text/javascript">
    var serial_number = $('#serial_number').html();

    $(function () {
        $('input[name=date-range-picker]').daterangepicker({
                    startDate: moment().subtract(1, 'days'),
                    endDate: moment(),
                    locale: {
                        format: "YYYY/MM/DD",
                        applyLabel: '提交',
                        cancelLabel: '取消',
                        fromLabel: '开始时间',
                        toLabel: '结束时间',
                        weekLabel: 'W',
                        customRangeLabel: 'Custom Range',
                        daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
                        monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                        firstDay: moment.localeData()._week.dow
                    },
                    language: 'cn'
                }
        ).prev().on(ace.click_event, function () {
            $(this).next().focus();
        });


        $(document).ready(function () {
            Highcharts.setOptions({
                global: {
                    useUTC: false
                },
                lang: {
                    resetZoom: '重置',
                    resetZoomTitle: '重置缩放比例'
                }
            });
            var chartInitA = function (series) {
                $('#containerA').highcharts({
                    chart: {
                        zoomType: 'x',
                        type: 'spline',
                        backgroundColor: 'rgba(0,0,0,0)',
                        animation: Highcharts.svg, // don't animate in old IE
                        marginRight: 10
                    },
                    title: {
                        text: '分流器上/下行流量(KB)'
                    },
                    xAxis: {
                        type: 'datetime',
                        tickPixelInterval: 100,
                    },
                    yAxis: {
                        title: {
                            text: '分流器上/下行流量'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        formatter: function () {
                            return '<b>' + this.series.name + '</b><br/>' +
                                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>  ' +
                                    Highcharts.numberFormat(this.y, 0) + 'KB';
                        }
                    },
                    exporting: {
                        enabled: false
                    },
                    series: series
                });
            };
            var chartInitB = function (series) {
                $('#containerB').highcharts({
                    chart: {
                        zoomType: 'x',
                        type: 'spline',
                        backgroundColor: 'rgba(0,0,0,0)',
                        animation: Highcharts.svg, // don't animate in old IE
                        marginRight: 10
                    },
                    title: {
                        text: '分流器收/发包个数'
                    },
                    xAxis: {
                        type: 'datetime',
                        tickPixelInterval: 100,
                    },
                    yAxis: {
                        title: {
                            text: '分流器收/发包个数'
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        formatter: function () {
                            return '<b>' + this.series.name + '</b><br/>' +
                                    Highcharts.dateFormat('%Y-%m-%d %H:%M:%S', this.x) + '<br/>  ' +
                                    Highcharts.numberFormat(this.y, 0) + '个';
                        }
                    },
                    exporting: {
                        enabled: false
                    },
                    series: series
                });
            };

            $('#search').on('click', function (e) {
                e.stopPropagation();
                e.preventDefault();

                var ip = $('#ips').val();
                var times = $('#id-datetime').val();
                $.get("__URL__/getflowhistory", {ip: ip, times: times}, function (res) {
                    var dataA = [];
                    var dataB=[];
                    $.each(res.a, function (i, m) {
                        var subdataA = [];
                        $.each(m.data, function (k, j) {
                            subdataA.push({
                                x: j.x*1000,
                                y: parseInt(j.y)
                            });
                        });
                        dataA.push({
                            name: i,
                            data: subdataA
                        })
                    });

                    $.each(res.b, function (ii, mm) {
                        var subdataB = [];
                        $.each(mm.data, function (kk, jj) {
                            subdataB.push({
                                x: jj.x*1000,
                                y: parseInt(jj.y)
                            });
                        });
                        dataB.push({
                            name: ii,
                            data: subdataB
                        })
                    });
                    chartInitA(dataA);
                    chartInitB(dataB);
                }, 'json')
            });

            $('#search').click();
        });

    });
</script>
