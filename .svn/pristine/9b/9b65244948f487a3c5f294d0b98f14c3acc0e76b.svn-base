function rndIdentity(b,c){var a=new Date().getTime();rndIdentity=function(e,f){a=(a*69069)%2147483648;var d=(a/2147483648).toString().replace(/\w\./,"");if(e){d=e+d;}if(f){d=d+f;}return d;};return rndIdentity(b,c);}function selectOrMoveEndContenteditable(d,a){var b,c;if(document.createRange){b=document.createRange();b.selectNodeContents(d);if(!a){b.collapse(false);}c=window.getSelection();c.removeAllRanges();c.addRange(b);}else{b=document.body.createTextRange();b.moveToElementText(d);if(!a){b.collapse(false);}b.select();}}function createEventHandler(evtstr,option){var getHandler=function(obj,names){names=names.split(".");for(var i=0,len=names.length;obj&&i<len;i++){obj=obj[names[i]];}return typeof(obj)=="function"?obj:null;};createEventHandler=function(evtstr,option){if(!evtstr){return null;}var type=typeof(evtstr);if(type!="string"){return type=="function"?evtstr:null;}if(!evtstr.trim()){return null;}var func=null;try{if(/^\w+(\.\w+)*$/.test(evtstr)){var objs=null;if(option){objs=option["objs"];}if(!objs){objs=[window];}else{if(Object.prototype.toString.call(objs)!="[object Array]"){objs=[objs];}}for(var i=0,len=objs.length;!func&&i<len;i++){func=getHandler(objs[i],evtstr);}}else{evtstr=evtstr.replace(/^\/\/.*(\r\n|\n|$)/mg,"");if(/^function\s*\(/.test(evtstr)){func=window.eval("(function(){\r\n return "+evtstr+"\r\n})()");}else{var args=null;if(option){args=option["args"];}if(!args){args=[];}else{if(Object.prototype.toString.call(args)!="[object Array]"){args=[args];}}args.push(evtstr);func=Function.apply(this,args);}}}catch(e){e.message=I18N.getString("esmain.pagedesigner.js.portalutil.js.wrongis","错误：")+'<span style="color: red">'+e.message+"</span>\r\n"+'<div style="padding: 0px 30px;color:#666">'+I18N.getString("esmain.pagedesigner.js.portalutil.js.checkformat","请检查自定义事件格式，内容如下：")+"\r\n"+'<pre style="padding: 3px 10px;color: #333;font-family:Verdana !important">'+evtstr+"</pre></div>";showError(e);}return func||null;};return createEventHandler(evtstr,option);}var JsClipboard=(function(d){if(!d["__jsclipboard__"]){var b=null,a=null;if(d.clipboardData){b=function(f){if(f==null){return;}d.clipboardData.clearData();d.clipboardData.setData("Text",f);};a=function(){return d.clipboardData.getData("text");};}else{var e=d.document,c=e.body.appendChild(e.createElement("textarea"));c.setAttribute("jsclipboard",true);c.style.cssText+="; position: absolute; left: -999999px; top: -999999px; opacity: 0";b=function(f){if(f!=null){c.value=f;}c.focus();c.setSelectionRange(0,(f||c.value).length);};a=function(){return c.value;};}d["__jsclipboard__"]={setData:b,getData:a};}return d["__jsclipboard__"];})(window);var PortalConstants={TYPE_WIDGET:"widget",TYPE_CONTAINER:"container",TYPE_BOTH:"both",NAME_DATA_ROLE:"data-role",NAME_DATA_LAYOUT:"data-layout",NAME_DATA_PROPERTY:"data-props",NAME_DATA_DROPPABLE:"data-droppable",NAME_DATA_NOCONTENT:"data-nocontent",NAME_DATA_UNSAVE:"data-unsave",NAME_DATA_READONLY:"data-readonly",NAME_DATA_LOCATE:"data-locate",NAME_DATA_POS:"data-pos",NAME_DATA_RELAYOUT:"data-relayout",NAME_DATA_WIDGETID:"widget-id",NAME_DATA_IDENTIFY:"data-id",NAME_DATA_NAME:"data-name",VALUE_ROLE_PAGE:"page",VALUE_ROLE_GRID:"container-grid",VALUE_ROLE_CELL:"container-cell",VALUE_ROLE_RESOURCE:"resource",VALUE_ROLE_WIDGET:"widget",VALUE_ROLE_WIDGET_XUI:"xui-widget",NAME_PPT_HIDDEN:"ppt-hidden",CONTENT_EDITOR:"content-editor",TYPE_EDITOR_NONE:"noneeditor",TYPE_EDITOR_XML:"xmleditor",TYPE_EDITOR_TREE:"treeeditor",TYPE_EDITOR_TAB:"tabeditor",TYPE_EDITOR_MENU:"menueditor",TYPE_EDITOR_TEXT:"texteditor"};var PortalEvent=(function(){var b=["data-event-bind","data-on-click","data-on-dblclick","data-on-keydown","data-on-keypress","data-on-keyup","data-on-mousedown","data-on-mousemove","data-on-mouseover","data-on-mouseout","data-on-mouseup","data-on-focus","data-on-blur"];var a={"data-on-click":"click","data-on-dblclick":"dblclick","data-on-keydown":"keydown","data-on-keypress":"keypress","data-on-keyup":"keyup","data-on-mousedown":"mousedown","data-on-mousemove":"mousemove","data-on-mouseover":"mouseover","data-on-mouseout":"mouseout","data-on-mouseup":"mouseup","data-on-focus":"focus","data-on-blur":"blur"};var f=function(i){var h=null,j=null;while(i){h=i.getAttribute(PortalConstants.NAME_DATA_WIDGETID);if(h){j=i.getAttribute(PortalConstants.NAME_DATA_IDENTIFY);break;}i=i.parentNode;}return j?[j,h]:null;};function e(h){var k=-(1/h).toRound(2),j=[-k*(h-1)-1];for(var l=1;l<h;l++){j.push(k);}return j;}var d=function(x,l,m){var y=PortalConstants.NAME_DATA_LAYOUT,k=JSON.parse(x.getAttribute(y));var u=k["colwidths"],B=k["rowheights"],n=[];if(u){u=l(u);}else{u=e(parseInt(k["cols"])||1);}if(B){B=l(B);}else{B=e(parseInt(k["rows"])||1);}var i=x.firstChild,A=B.length,v=u.length,q=0,o=0,j=n[0]=[],p=null;for(var t=null;i;i=t){t=i.nextSibling;if(i.nodeType!==1){x.removeChild(i);continue;}i.style.position="absolute";p=i.getAttribute(y);if(p){try{p=JSON.parse(p);}catch(C){}}if(!p){p={};}rs=p["rowspan"]||1,cs=p["colspan"]||1;if(rs>1||cs>1){for(var w=q,h=q+rs;w<h;w++){var z=n[w]=n[w]||[];for(var D=(w===q?o+1:o),s=o+cs;D<s;D++){z[D]={r:q,c:o};}}}i.style.width="";i.style.height="";j[o]={dom:i,rs:rs,cs:cs};o+=cs;while(true){while(j[o]){o++;}if(o>v){throw new Error("布局行列合并信息有误.");}if(o===v){if(++q>A){throw new Error("布局行列合并信息有误.");}if(q===A){break;}j=n[q]=n[q]||[];o=0;continue;}break;}}x.style.position="relative";["gap","hgap","vgap","fixedrows","fixedcols","stretchedrows","stretchedcols"].forEach(function(E){var r=k[E];if(r!=undefined){this[E]=r;}},m);return[n,u,B];};var g=function(j,h){var k=XWidgetTemplateFactory.getInstance();var i=function(q,o,s,l,n){if(!n){n=f(q);}if(!n){return;}var r=o(n[0]);if(!r){return;}var p=k.getTemplate(n[1]);if(!p){return;}var m=createEventHandler(l,{objs:[p.getProperty(XWidgetTemplateFactory.TEMPLATE_SCRIPT4EVENTS),window],args:"evt"});if(!m){return;}$(q).bind(a[s],r,m);};g=function(m,l){if(arguments.length!=2){i.apply(null,arguments);return;}b.slice(1).forEach(function(n){[].forEach.call(this.find("["+n+"]"),function(p){var o=p.getAttribute(n).trim();if(!o){return;}i(p,l,n,o);});},$(m));};g.apply(null,arguments);};var c=function(k){var l=$(k),m=null;for(var j=1,h=b.length;j<h;j++){m=b[j];l.find("["+m+"]").unbind(a[m]);}};return{NAME_DATA_EVENTS:b,getWidgetIds:f,checkLayoutInfo:d,bind:g,unbind:c};})();function showConfirm(j,h,e,c,f){var g=Array.prototype.slice.call(arguments,1);if(j){var a=j["width"],i=j["height"],b=j["tipicon"],d=!j["hasscroll"];if(a||i||b||d){g.splice(3,1,function(n){var k=null,l=null;if(a){k=n.getWidth();n.setWidth(a);}if(i){l=n.getHeight();n.setHeight(i);}if(b){n.setImg(b);}if(d){n.getContent().style.cssText+="; overflow: hidden";}var m=n.onclose;n.setOnClose(function(){if(k){this.setWidth(k);}if(l){this.setHeight(l);}if(b){this.setImg(sys.getImgPath("hint.gif"));}if(d){n.getContent().style.cssText+="; overflow: auto";}if(typeof(m)=="function"){m.call(this,this);}this.setOnClose(m);});if(typeof(f)=="function"){f(n);}});}}confirmDialog.apply(this,g);}function queryResourceNode(a,c,b){if(!a||typeof(c)!=="function"){return;}QueryObj.create("/esmain/portalresource.do","rid="+a,function(f,d){try{f.checkResult();d["callback"](f.getResponseXML(),d["extArgs"]);}catch(g){showError(g);}},{callback:c,extArgs:b});}function queryPortalFile(a,c,b){if(!a||typeof(c)!=="function"){return;}QueryObj.create("portalmgr.do","command=list&path="+a,function(f,d){try{f.checkResult();d["callback"](f.getDetail(),d["extArgs"]);}catch(g){showError(g);}},{callback:c,extArgs:b});}function browseIframes(l,h,k){if(typeof(l)!=="function"){return;}if(!h){h=document;}var j=h.getElementsByTagName("iframe");if(!j){return;}k=k===false?0:(isNaN(k=parseInt(k))?-1:k);for(var b=0,d=j.length;b<d;b++){var g=j[b],c=g.parentNode;try{if(g.clientWidth<=0||g.clientHeight<=0||c.clientWidth<=0||c.clientHeight<=0){continue;}var a=g.contentWindow,h=a.document;if(l(a,h,g)!==false&&k!==0){browseIframes(l,h,k-1);}}catch(f){}}}