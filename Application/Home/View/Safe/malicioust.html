<div class="main-content">
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try {
                ace.settings.check('breadcrumbs', 'fixed')
            } catch (e) {
            }
        </script>

        <ul class="breadcrumb">
            <li>
                安全事件
            </li>
            <li class="active">暴力破解检测</li>
        </ul>
        <!-- .breadcrumb -->
        <!-- #nav-search -->
    </div>
    <div class="col-sm-12">
        <div class="row">
            <div class="col-xs-12">

                <div class="formArea marT10" >
                    <form method="get"  action="">
                        <div class="formTextList">
                            <label class="floatLeft">时间：</label>
                            <div class="input-group w300 floatLeft" style="width:281px; text-indent:0px;">
			                    <span class="input-group-addon">
                                    <i class="icon-calendar bigger-110"></i>
			                     </span><input class="form-control date-range-picker" type="text" name="date1" data-date-format="YYYY-MM-DD"
                                               id="id-date-range-picker-1"/>
                            </div>
                        </div>


                        <button class="aptSearchBtn "><i class="fa fa-search"></i>查询</button>
                    </form>
                </div>

                <div class="chartBox marT10" style="position: relative">


                    <div class="aptBox aptBoxW4 aptBoxH3 boxShadowjc" >
                        <div id="container" style=" width:97%;height:100%;margin:auto;"></div>
                    </div>

                    <div class="aptBox aptBoxW6 aptBoxH3 marL10 boxShadowjc" >
                        <div id="container2" style=" width:97%;height:100%;margin:auto;"></div>
                    </div>
                    <!--30天http流量攻击趋势图的翻页-->
                    <div class=" aptBoxW6 " style="position: absolute;right: 1px;bottom: 40px">
                        <a href="#" style="position: absolute;top: 2px;left: 64px" title="查看上一周期" >
                            <i class="icon-caret-left icon-2x"></i>
                        </a>
                        <!--<h4 style="margin:3px 40%;">3-8——3-17</h4>-->
                        <a href="#"  style="position: absolute;top: 2px;right: 6px" title="查看下一周期">
                            <i class="icon-caret-right icon-2x" style="color: #c0c0c0"></i>
                        </a>
                    </div>
                    <div class="clearBoth"></div>
                </div>

                 <div class="formArea marT10" >
                     <div class="formTextList">
                         <label class="floatLeft">时间：</label>
                         <div class="input-group w300 floatLeft" style="width:281px; text-indent:0px;">
			                    <span class="input-group-addon">
                                    <i class="icon-calendar bigger-110"></i>
			                     </span><input class="form-control date-range-picker" type="text" name="date2" data-date-format="YYYY-MM-DD"
                                               id="id-date-range-picker-2"/>
                         </div>
                     </div>

                     <div class="formTextList">
                         <label class="floatLeft">关键字：</label>
                         <input type="text" name="username" class="floatLeft" id="key">
                     </div>

                    <a href="#" class="aptSearchBtn">查询</a>
                     <div class="clearBoth"></div>

                </div>

                <div class="aptTable span10 marT10 tableShow boxShadowjc">
                    <div class="aptListBtnGroup"><h4><b>30</b>天暴力破解分布详情</h4></div>
                <!--<div class="aptListBtnGroup"><a href="#"><i class="icon-upload-alt"></i>导出</a></div>-->
                    <table id="reportTable"></table>
			</div>
                
                
            </div>
            </div>  
        </div>
        
    </div>
</div>
<script>
    $(document).ready(function(){
        function operateFormatter(value, row, index) {
            return [
                "<a href='#' class='editIcon marR5 editTable' title='编辑'><i class='icon-edit'></i></a><a href='javascript:;' class='delIcon delTable' title='删除' data-toggle='modal' data-target='#mySmModal''><i class='icon-trash'></i></a>"
            ].join('');
        }
        $('#reportTable').bootstrapTable({
            method: 'get',
//            url: '__URL__/indexbiao',
            cache: false,
//            height: 400,
            striped: true,
//            sidePagination:"server",
            pagination: true,
            pageSize: 10,
            pageNumber: 1,
            pageList: [10],
            sortName : 'Time',
            sortOrder : 'desc',
            showColumns: true,

            queryParams: function (params) {
                var pars = {
                    pagenum:params.offset/params.limit+1,
                    order:params.order,
                    sort:params.sort
                };
                return pars;
            },
            columns: [{
                checkbox: true,
            },
                {
                    field: "type",
                    title: "类型",
                    align: "center",
                    valign: "middle",
                    sortable: false,
                    /* formatter:function(value,row,index){
                     return formateDate2(value);
                     }*/
                },
                {field: "fristTime", title: "首次发现时间", align: "center", valign: "middle", sortable: false},
                {field: "lastName", title: "最后发现时间", align: "center", valign: "middle", sortable: false},
                {field: "attackPrice", title: "被攻击资产", align: "center", valign: "middle", sortable: false},
                {field: "attackIP", title: "攻击者IP", align: "center", valign: "middle", sortable: false},
                {field: "attackAgree", title: "攻击使用协议", align: "center", valign: "middle", sortable: false},
                {field: "burstTime", title: "发起爆破次数", align: "center", valign: "middle", sortable: false},
                {field: "biaoji", title: "标记", align: "center", valign: "middle", sortable: false},


                {
                    field: "place_set",
                    title: "操作",
                    align: "center",
                    valign: "middle",
                    sortable: false,
                    switchable: false,
                    formatter: operateFormatter
                }],
            data: [{
                "type": "00-E0-4C-3B-7D-2F",
                "fristTime": "2017-03-12",
                "lastName": "2017-03-21",
                "attackPrice": "-",
                "attackIP": "127.168.34.5",
                "attackAgree": "木马",
                "burstTime": "120.0.0.1",
                "biaoji": "已标记",
                "place_set": "-",
            }],
            onLoadSuccess:function(data){
//                    console.log(data);
            },
            responseHandler:function(res) {
                var tem = {"total":0,"rows":[]};
                if(res.status){
                    tem.total = res.totalNum;
                    tem.rows = eval(res.data);
                }else{
                    $('#reportTable').bootstrapTable('removeAll');
                }
                return tem;
            },
            onLoadError:function(status,res){
                $('#reportTable').bootstrapTable('removeAll');
                console.log(status,res);
            }
        });
        $(window).resize(function () {
            $('#reportTable').bootstrapTable('resetView');
        });

        /*$('#kSearch').click(function(){
         var uname = $('#uname').val();
         $('#reportTable').bootstrapTable('refresh');
         });*/

    });

    var chart1=function(data){
        $('#container').highcharts({
//            colors: [ "#FFCC67", "#86D560", "#FF999A", "#AF89D6", "#59ADF3"],
            colors: ['#335AA7', '#7DC8DB', '#CBE8FA', '#6DC6F2', '#36B0BB'],
            chart:{
                backgroundColor: '#fefefe',
                type: 'pie',
                options3d: {
                    enabled: true,
                    alpha: 50,
                    beta: 0
                },
            },
            title: {
                text: '30天暴力破解分布'
            },
            credits:{
                enabled:false // 禁用版权信息
            },
            tooltip: {
                pointFormat: '攻击占比: <b>{point.percentage:.1f}%</b><br>'+'{series.name}: <b>{point.y}</b>'
            },
            exporting: {
                enabled: false
            },
            plotOptions: {
//                radius: ['58%', '83%'],
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    depth: 25,
                    dataLabels: {
                        enabled: true,
                        //format: '{point.name}'
                        format: '<b>{point.name}</b>',
                        style: {
                            color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
                        }
                    },
                }
            },
            series: [{
                type: 'pie',
                innerSize:"40%",
                name: '攻击数',
                data: [['后门',30],['鸡肉行为',40],['蠕虫病毒',40],['木马回连',20],['木马回连',20]]

            }]
        });
    }


    var chart2=function(data){
        $('#container2').highcharts({
            chart: {
                type: 'column'
            },
            title: {
                text: '30天暴力破解分布趋势图'
            },
            credits:{
                enabled:false // 禁用版权信息
            },
            xAxis: {
                type: 'category',
                labels: {
                    style: {
                        fontSize: '14px',
                        fontFamily: 'Verdana, sans-serif'
                    }
                },
            },
            yAxis: {
                min: 0,
                title: {
                    text: '数量(个)'
                }
            },
            legend: {
                enabled: false
            },
            tooltip: {
                formatter: function () {
                    return '<b>' + this.x + '</b><br/>' +
                            '告警类别: ' + this.series.name + '<br/>' +
                            '个数: ' + this.y;
                }
            },
            plotOptions: {
                column: {
                    stacking: 'normal',
                    pointPadding: 0.2,
                    borderWidth: 0,
                    pointWidth: 30
                }
            },
            series: [{
                name: 'SQL注入',
                data: [
                    ['3-8',2],['3-9',3],['3-10',4],['3-11',1],['3-12',2],['3-13',2], ['3-14',5],['3-15',3],
                    ['3-16',2],
                    ['3-17',2]
                ]
            }, {
                name: '非正常登陆',
                data: [
                    ['3-8',2],['3-9',3],['3-10',4],['3-11',1],['3-12',2],['3-13',2], ['3-14',5],['3-15',3],
                    ['3-16',2],
                    ['3-17',2]
                ]
            }, {
                name: '鸡肉行为',
                data: [
                    ['3-8',2],['3-9',3],['3-10',4],['3-11',1],['3-12',2],['3-13',2], ['3-14',5],['3-15',3],
                    ['3-16',2],
                    ['3-17',2]
                ]
            }]
        });


    }
    chart1();
    chart2();
    //当左侧菜单栏显示或隐藏时图表重绘
    $('.icon-double-angle-left').click(function(){
        if($('.col-xs-12').css("width")!=$('.main-content').css("min-width")){
            if($('#sidebar-collapse i').attr('class')=='icon-double-angle-left'){

                setTimeout(function(){
                    $('#container2').highcharts().reflow();
                },1)
            }else{
                setTimeout(function(){
                    $('#container2').highcharts().reflow();
                },1)
            }

//            $('#container2').highcharts().reflow();

        }
    });
</script>
<!--初始化全局日期-->
<script>
    //获取时间方法
    Date.prototype.Format = function (fmt) {
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate() //日
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    }
    //获取当前日期
    var endTime= new Date().Format("MM/dd/yyyy");//Format("输入你想要的时间格式:yyyy-MM-dd,yyyyMMdd")
    //结束时间
    var date = new Date();//获取当前时间
    date.setDate(date.getDate()-30);//设置天数 30 天
    var starTime = date.Format("MM/dd/yyyy"); //减完30天以后的时间
    date1=$('input[name="date1"]').val(starTime+" - "+endTime)
</script>
<script>
    jQuery(function ($) {
        $('#id-date-range-picker-1').daterangepicker({
                    startDate: moment().subtract(30, 'days'),
                    endDate: moment(),
                    locale : {
                        applyLabel: '提交',
                        cancelLabel: '取消',
                        fromLabel: '开始时间',
                        toLabel: '结束时间',
                        weekLabel: 'W',
                        customRangeLabel: 'Custom Range',
                        daysOfWeek: ['日', '一', '二', '三', '四', '五','六'],
                        monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                        firstDay: moment.localeData()._week.dow
                    },
                    dateLimit : {
                        day : 30
                    },
                    timePickerIncrement : 1440, //时间的增量，单位为分钟
                    language: 'cn',}
        ).prev().on(ace.click_event, function () {
                    $(this).next().focus();
                });

    })
    time();
    function time(){
        var arr=timeFormat();
        jQuery(function ($) {
            $('#id-date-range-picker-2').daterangepicker({
                        startDate: moment().subtract(arr.days, 'days'),
                        endDate: moment(),
                        maxDate : arr.dateT1,
                        minDate:arr.dateS1,
                        locale : {
                            applyLabel: '提交',
                            cancelLabel: '取消',
                            fromLabel: '开始时间',
                            toLabel: '结束时间',
                            weekLabel: 'W',
                            customRangeLabel: 'Custom Range',
                            daysOfWeek: ['日', '一', '二', '三', '四', '五','六'],
                            monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                            firstDay: moment.localeData()._week.dow
                        },
                        dateLimit : {
                            day : 29
                        },
                        timePickerIncrement : 1440, //时间的增量，单位为分钟
                        language: 'cn',}
            ).prev().on(ace.click_event, function () {
                        $(this).next().focus();
                    });
        })
    }
    function timeFormat(){
        var arr=[];
        //    上面日期的分割
        var date1=$('input[name="date1"]').val().split('-');

//    格式化全局日期的起止时间
        var timeS1=date1[0].split('/');
        timeS1= timeS1.join('-').trim();
        var timeT1=date1[1].split('/');
        timeT1= timeT1.join('-').trim();
        var dateS1 = new Date(timeS1);
        arr.dateS1=dateS1;
        var dateT1 = new Date(timeT1);arr.dateT1=dateT1;
        var date3=dateT1.getTime()-dateS1.getTime();
        var days=Math.floor(date3/(24*3600*1000));arr.days=days;
        return arr;
    }

</script>
