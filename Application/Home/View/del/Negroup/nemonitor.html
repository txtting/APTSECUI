<div class="main-content">
    <div id="imgRequest" class="loadImg"></div>
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try {
                ace.settings.check('breadcrumbs', 'fixed')
            } catch (e) {
            }
        </script>

        <ul class="breadcrumb">
            <li>
                设备管理
            </li>
            <li>
                设备列表
            </li>
            <li class="active">设备信息历史查询</li>
        </ul>
        <!-- .breadcrumb -->

    </div>
    <div class="col-sm-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="tabbable marT10">


                    <div id="home" class="tab-pane  in active">

                        <div class="formArea" style="padding-bottom:12px;">

                                <label class="marL10 floatLeft" style="line-height:30px">选择时间：</label>

                            <div class="input-group w300 floatLeft">
			                     <span class="input-group-addon">
			                         <i class="icon-calendar bigger-110"></i>
			                     </span>

                                <input class="form-control" type="text" name="date-range-picker"     id="id-date-range-picker-1"/>
                            </div>
                                
                                <label class="w70">&nbsp;</label>
                                <button class="btn btn-sm btn-primary"><i class="fa fa-search"></i>查询</button>   
                        </div>
                        <!--
                        <div id="checkTab">
                            <label style="margin: 10px"><input type="checkbox" name="Group" value="1" autocomplete="off" >内存使用率</label>
                            <label style="margin: 10px"><input type="checkbox" name="Group" value="2" autocomplete="off" >存储资源使用率</label>
                            <label style="margin: 10px"><input type="checkbox" name="Group" value="3" autocomplete="off" >CPU温度</label>
                            <label style="margin: 10px"><input type="checkbox" name="Group" value="4" autocomplete="off" >并发会话数</label>
                            <label style="margin: 10px"><input type="checkbox" name="Group" value="5" autocomplete="off" >业务口流量</label>
                        </div>
                        -->
                        <div>
                        <div id="container1" class="is-chart" style="height:230px;"></div>
                        <div id="container2" class="is-chart" style="height:230px;"></div>
                        <div id="container3" class="is-chart" style="height:230px;"></div>
                        </div>
                        
                            <!--<script id="charts-tpl" type="text/html">
                                <div id="container" class="is-chart">
                                </div>
                            </script>-->
                        </div>
                        <div style="clear:both;"></div>
                    </div>

                </div>


            </div>
            <!-- /span -->
        </div>
        <!-- /row -->
    </div>

</div>


<script type="text/javascript">
$(function () {
    $('#container1').highcharts({
        title: {
            text: 'CPU使用率历史趋势',
            x: -20 //center
        },
        subtitle: {
            text: '',
            x: -20
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                         'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        yAxis: {
            title: {
                text: '单位 (%)'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            valueSuffix: '%'
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name: 'CPU使用率',
            data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
        }]
    });
});


$(function () {
    $('#container2').highcharts({
        title: {
            text: '网络状态趋势',
            x: -20 //center
        },
        subtitle: {
            text: '',
            x: -20
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                         'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        yAxis: {
            title: {
                text: '单位 (%)'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            valueSuffix: '%'
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name: '网络状态',
            data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
        }]
    });
});


$(function () {
    $('#container3').highcharts({
        title: {
            text: '硬盘使用率',
            x: -20 //center
        },
        subtitle: {
            text: '',
            x: -20
        },
        xAxis: {
            categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                         'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
        },
        yAxis: {
            title: {
                text: '单位 (%)'
            },
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        tooltip: {
            valueSuffix: '%'
        },
        legend: {
            layout: 'vertical',
            align: 'right',
            verticalAlign: 'middle',
            borderWidth: 0
        },
        series: [{
            name: 'Berlin',
            data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
        }]
    });
});













    $(document).ready(function ($) {
        $("#home .chartContainer").width($(".chartContainer").width());
        var chartTpl      = $("#charts-tpl").html();
        var isnet         = 1;
        $("#charts-tpl").remove();
        var chartinit     = function ($c, $data, $reinit) {
            Highcharts.setOptions({
                lang:{
                    contextButtonTitle:"图表导出菜单",
                    decimalPoint:".",
                    downloadJPEG:"下载JPEG图片",
                    downloadPDF:"下载PDF文件",
                    downloadPNG:"下载PNG文件",
                    downloadSVG:"下载SVG文件",
                    drillUpText:"返回 {series.name}",
                    loading:"加载中",
                    months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],
                    noData:"没有数据",
                    numericSymbols: null,//[ "K" , "M" , "G" , "T" , "P" , "E"],
                    printChart:"打印图表",
                    resetZoom:"恢复缩放",
                    resetZoomTitle:"恢复缩放",
                    shortMonths: ["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],
                    thousandsSep:",",
                    weekdays: ["星期一", "星期二", "星期三", "星期三", "星期四", "星期五", "星期六","星期天"]
                }
            });
            $c.highcharts({
                chart      : {
                    zoomType    : 'x',
                    spacingRight: 20
                },
                title      : {
                    text: $data.title.title
                },
                subtitle   : {},
                xAxis      : {
                    type                : 'datetime',
                    maxZoom             : $data.maxZoom,
                    title               : {
                        text: null
                    },
                    dateTimeLabelFormats: {
                        minute:"%H:%M",
                        hour:" %H:%M",
                        day:"%b %e",
                    },
                    //categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun','Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
                },
                yAxis      : {
                    title: {
                        text: $data.title.yAxis
                    }
                },
                tooltip: {
                    enabled: true,
                    pointFormat: '<span style="color:{point.color}">\u25CF</span> {series.name}: <b>{point.y}{series.company}</b><br/>',
                    //crosshairs: null,
                    dateTimeLabelFormats: {
                        /* millisecond: '%Y-%m-%d %H:%M:%S',*/
                        second: '%Y-%m-%d %H:%M:%S',

                    },

                },

                legend     : {
                    enabled: false
                },
                plotOptions: {
                    area: {
                        fillColor: {
                            linearGradient: {x1: 0, y1: 0, x2: 0, y2: 1},
                            stops         : [
                                [0, Highcharts.getOptions().colors[0]],
                                [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                            ]
                        },
                        lineWidth: 1,
                        marker   : {
                            enabled: false
                        },
                        shadow   : false,
                        states   : {
                            hover: {
                                lineWidth: 1
                            }
                        },
                        threshold: null
                    }
                },
                series     : $reinit == undefined ? $data.series : $reinit
            });
        };
        var contentInit   = function (data) {
            var chartCount = 0;
            $("#charts-view").html("");
            $.each(data, function (index, value) {
                laytpl(chartTpl).render({
                    chartCount: chartCount,
                    data      : value
                }, function (html) {
                    $("#charts-view").append(html);
                    var chart     = $("#chart_" + chartCount);
                    var container = chart.find(".chart-container");
                    chartinit(container, value);
                    chart.find(".table").find("tr").bind("click", function () {
                        var _this    = $(this);
                        !_this.hasClass("text-decoration") ? _this.addClass("text-decoration") : _this.removeClass("text-decoration");
                        var tbid     = _this.attr("tbid");
                        var chart_id = _this.parents(".is-chart").attr("id").replace("chart_", "");
                        var _data    = [];
                        var ids      = {};
                        $.each(_this.parents(".is-chart").find("tr[tbid]"), function (index, value) {
                            value = $(value);
                            if (!value.hasClass("text-decoration")) {
                                ids[value.attr("tbid")] = "";
                            }
                        });
                        $.each(data[chart_id].series, function (index, value) {
                            if (ids.hasOwnProperty(value.tbid)) {
                                _data.push(value);
                            }
                        });
                        chartinit(container, value, _data);
                    });
                });
                chartCount++;
            });
        };

        
        var getUrlParam = function (name) {
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
                var r = window.location.search.substr(1).match(reg);
                if (r != null) return unescape(r[2]); return null;
            }

        var fetchFormData = function (treeId) {

            var charts       = [];
            var time         = $("#id-date-range-picker-1").val();
            $.each($("input[name='Group']:checked"), function (index, value) {
                charts.push($(value).val());
            });

            var id = getUrlParam('id');

            return {
                isnet : isnet,
                charts: charts,
                time: time,
                id : id

            };
        };
        var fetchData     = function (data) {
            $.post("{:U('nemonitor')}", data, function (data) {

                if (!data.data) {
                    return false;
                }

                contentInit(data.data);
            });
        };



        $(":checkbox").change(function () {
            fetchData(fetchFormData());
        });

        $("button").click(function () {
            fetchData(fetchFormData());
        });

    });
    $("#imgRequest").ajaxStart(function(){
        $("#imgRequest").show();
    });
    $("#imgRequest").ajaxStop(function(){
        $("#imgRequest").hide();
    });
</script>
<script type="text/javascript">
    $("#home .chartContainer").width($(".chartContainer").width());
    /*  $("#selMonitoringContent").bind("change", function () {
     var index = this.options[this.options.selectedIndex].value;
     $("#home .chartContainer").eq(index).show().siblings().hide();
     });*/

    $("#checkTab label input").click(function () {
        var index = $("#checkTab label input").index(this);
        $("#home .chartContainer").eq(index).toggle();

    })
    jQuery(function ($) {
        $('input[name=date-range-picker]').daterangepicker({
                    startDate: moment().subtract(1, 'days'),
                    endDate: moment(),
                    locale : {
                        applyLabel: '提交',
                        cancelLabel: '取消',
                        fromLabel: '开始时间',
                        toLabel: '结束时间',
                        weekLabel: 'W',
                        customRangeLabel: 'Custom Range',
                        daysOfWeek: ['日', '一', '二', '三', '四', '五','六'],
                        monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                        firstDay: moment.localeData()._week.dow
                    },
                    language: 'cn',}
        ).prev().on(ace.click_event, function () {
                    $(this).next().focus();
                });
    })
</script>