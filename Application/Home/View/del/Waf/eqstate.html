<div class="main-content">
    <div id="del_forms" class="popLayer" style="top:100px;left:50%;width: 40%;margin-left:-20%;">
        <div class="breadcrumbs">
            <ul class="breadcrumb">
                <li>
                    删除报表
                </li>
            </ul>
            <!-- .breadcrumb -->
            <span class="floatRig closePop">关闭</span>
        </div>
        <div class="col-sm-12">
            <div class="row">
                <div class="col-xs-win">
                    <!-- PAGE CONTENT BEGINS -->
                    <form style="position:relative;top:20px;" id="dels_form" class="form-horizontal" role="form">

                        <div class="form-group">
                            <label class="col-sm-4 control-label no-padding-right"> 确定要删除吗？ </label>
                        </div>

                        <input type="hidden" id="id"/>

                        <div class="clearfix form-actions">
                            <div>
                                <button class="allusers btn btn-danger">
                                    <i class="icon-remove  bigger-110 "></i>
                                    确定
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </div>
    </div>
    <div id="fade" class="black_overlay"></div>
    <div class="breadcrumbs" id="breadcrumbs">
        <script type="text/javascript">
            try {
                ace.settings.check('breadcrumbs', 'fixed')
            } catch (e) {
            }
        </script>

        <ul class="breadcrumb">
            <li>
                报表管理
            </li>
            <li class="active">报表分析</li>
        </ul>
        <!-- .breadcrumb -->
        <!-- #nav-search -->
    </div>
    <div class="col-sm-12">
        <div class="row">
            <div class="col-xs-12">
                <div class="formArea">
                    <form method="post" id="add_report_form">
                        <div class=" floatLeft marL10">
                            <label class="marL10">报表类型：</label>
                            <select name="report_form_type" class="" id="time_select">
                                <option value="1">年报</option>
                                <option value="2">月报</option>
                                <option value="3">日报</option>
                            </select>
                            <input type="text"  name="report_form_time" class="form_date_year" required/>
                            </div>
                        <div>
                            <label class="marL10">IP：</label><input type="text" name="ip" class="w100 username">
                            <button class="btn btn-sm btn-primary marL10"><i class="fa fa-search"></i>生成报表</button>
                        </div>
                    </form>
                    <div class="clearBoth"></div>
                </div>
                <div class="buttonGroup">
                                <a href="javascript:;" class="btn btn-link dels_report_form" title='批量删除'>
                                    <i class="icon-remove  bigger-120 red "></i>批量删除
                                </a>
                            </div>
                <div class="table-responsive marT10">
                    <table id="table" class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th><input name='checkbox' type="checkbox"></th>
                            <th>报表名称</th>
                            <th>生成时间</th>
                            <th>设备IP</th>
                            <th>报表类型</th>
                            <th>报表日期</th>
                            <!-- <th>下载</th> -->
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name='reportformdata' id="reportformdata_vo">
                            <tr>
                                <td><input type="checkbox" name="checkbox" value="{$reportformdata_vo.id}"></td>
                                <td><a href="__URL__/reportform/id/{$reportformdata_vo.id}">{$reportformdata_vo.report_form_name}</a></td>
                                <td>{$reportformdata_vo.time_stamp|date='Y-m-d H:i:s',###}</td>
                                <td><if condition="$reportformdata_vo.ip neq ''">{$reportformdata_vo.ip}<else/>全部设备</if></td>
                                <td><if condition="$reportformdata_vo.report_form_type eq 1">年报<elseif condition="$reportformdata_vo.report_form_type eq 2"/>月报<else/>日报</if></td>
                                <td>{$reportformdata_vo.report_form_time}</td>
                                <!-- <td><a href="{:U(WafI/reportformdown)}">下载</a></td> -->
                                <td>
                                    <a class="green editeUser" href="__URL__/reportform/id/{$reportformdata_vo.id}" title="查看">
                                        <i class="icon-search bigger-130"></i>
                                    </a>
                                    <a class="red del_report_form" href="javascript:;" title="删除">
                                        <i class="icon-trash bigger-130"></i>
                                    </a>
                                </td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="dataTables_paginate paging_bootstrap">
            <ul class="pagination">
                {$show}
            </ul>
        </div>
    </div>
</div>

<script>
    $(document).ready(function(){
        $(':checked').attr('checked',false);
    })
    $('.del_report_form').click(function(){
        $(':checked').attr('checked',false);
        $(this).parents('tr').children("td:eq(0)").children().attr('checked','checked');
        var ids = $("input:checkbox[name='checkbox']:checked").map(function(){
            return $(this).val();
        }).get().join(',');
        $('#del_forms').show();
        $('#fade').show();
        $('#del_forms #id').val(ids);
    })
    $('.dels_report_form').click(function(){
        var ids = $("input:checkbox[name='checkbox']:checked").map(function(){
            return $(this).val();
        }).get().join(',');
        if(ids==''||ids=='on'){
            $(':checked').attr('checked',false);
            layer.alert('请选择要删除的数据');
        }else{
            if(ids.indexOf("on,") >= 0){
               ids = ids.replace(/on,/g,'');
            }
            $('#del_forms').show();
            $('#fade').show();
            $('#del_forms #id').val(ids);
        }
    })
    $('.closePop').click(function(){
        $('#del_forms').hide();
        $('#fade').hide();
    })
    $('#dels_form').submit(function(e){
        e.stopPropagation();
        e.preventDefault();
        var id = $('#del_forms #id').val();
        $.ajax({
            url: '__CONTROLLER__/del_report_form',
            type: 'POST',
            dataType: 'json',
            data: {'ids': id},
            success: function(data){
                $('#del_forms').hide();
                $('#fade').hide();
                layer.alert(data.msg);
                window.location.href="__CONTROLLER__/eqstate";
            }
        })
    })
    jQuery(function ($) {
        $('input[name=date-range-picker]').daterangepicker({
                    startDate: moment().subtract(1, 'days'),
                    endDate: moment(),
                    locale: {
                        applyLabel: '提交',
                        cancelLabel: '取消',
                        fromLabel: '开始时间',
                        toLabel: '结束时间',
                        weekLabel: 'W',
                        customRangeLabel: 'Custom Range',
                        daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
                        monthNames: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月'],
                        firstDay: moment.localeData()._week.dow
                    },
                    language: 'cn',
                }
        ).prev().on(ace.click_event, function () {
                    $(this).next().focus();
                });
        $('#time_select').change(function(){
            var val= $("#time_select  option:selected").val();
            if(val==1){
                $('#time_select').next('input').remove();
                $('#time_select').after('<input type="text"  name="report_form_time" class="marL10 form_date_year" required/>');
            }else if(val==2){
                $('#time_select').next('input').remove();
                $('#time_select').after('<input type="text"  name="report_form_time" class="marL10 form_date_mon" required/>');
            }else{
                $('#time_select').next('input').remove();
                $('#time_select').after('<input type="text"  name="report_form_time" class="marL10 form_date_day" required/>');

            }
            $(".form_date_day").datetimepicker({
                format: 'yyyy-mm-dd',
                language: 'zh-CN',
                todayBtn: true,
                autoclose: 1,
                startView: 2,
                minView: 2
            });
            $(".form_date_mon").datetimepicker({
                format: 'yyyy-mm',
                language: 'zh-CN',
                todayBtn: true,
                autoclose: 1,
                startView: 3,
                minView: 3
            });
            $(".form_date_year").datetimepicker({
                format: 'yyyy',
                language: 'zh-CN',
                todayBtn: true,
                autoclose: 1,
                startView: 4,
                minView: 4
            });
        })
        $('#time_select').change()
    })
    $('#add_report_form').submit(function(e) {
        e.stopPropagation();
        e.preventDefault();
        var data = $('#add_report_form').serialize();
        $.ajax({
            url: '__CONTROLLER__/add_report_form',
            type: 'POST',
            dataType: 'json',
            data: data,
            success:function(data){
                layer.alert(data.msg);
                window.location.href="__CONTROLLER__/eqstate";
            }
        })
    });

</script>