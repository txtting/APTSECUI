(function(D){var d=null,m=null,t=null,A=null,F=null,e=null,f=null,n=null;var H="portal.do",i="../../vfs/root/portals/widgets/"+I18N.getLang()+"/default/common.xml",x=true;var s=[],p=/\w+\$\d+\$[^?]+/,o=null,q=null,j=null;function z(O,P){var M=O.length;if(M){for(var N=0;N<M;N++){t.loadTemplate(O[N],P);}return;}P();}function a(M){Array.prototype.forEach.call($(M).find("["+PortalConstants.NAME_DATA_ROLE+"="+PortalConstants.VALUE_ROLE_GRID+"]"),function(N){A[N.getAttribute(PortalConstants.NAME_DATA_IDENTIFY)]=XGridLayout.create({gridDom:N,checklayoutinfo:PortalEvent.checkLayoutInfo,enablelayout:N.getAttribute(PortalConstants.NAME_DATA_RELAYOUT)==="true",enableselect:false});});XGridLayout.layout();}function I(O,M){var N=e[O];if(!N){throw new Error(I18N.getString("esmain.portal.js.buildpage.js.2","未知组件【{0}】,无法获取对应组件对象.",[O]));}return N[M];}function l(N,P){var O=this.get("widget_template");var M=O.getProperty(XWidgetTemplateFactory.TEMPLATE_SCRIPT4PROPERTY)[N];if(M){M.call(this,P,N);}this.setProperty(N,P);}function g(M,W,T){var Q=A[M];if(Q==null){var S=j[M],V=f[M];if(!V){if(typeof(W)==="function"){if(!S){S=j[M]=[];}S.push({func:W,args:T});}return;}var U=t.getTemplate(I(M,PortalConstants.NAME_DATA_WIDGETID));Q=A[M]=new (U.getProperty(XWidgetTemplateFactory.TEMPLATE_WIDGET))({objs:V,props:new StringMap(I(M,PortalConstants.NAME_DATA_PROPERTY),";",":")});Q.set("widget_template",U);var X=U.getProperty(XWidgetTemplateFactory.TEMPLATE_SCRIPT4EVENTS),N=X["oninit"];if(N){J.call(this,Q,X,N);}Q.setProp=l;Q.getProp=Q.getProperty;if(S){for(var P=0,R=S.length;P<R;P++){var O=S[P];O["func"].call(this,Q,M,O["args"]);}delete j[M];}delete q["_$lazy$_"+M];}if(typeof(W)==="function"){W.call(this,Q,M,T);}return Q;}function L(O,M){for(var N in M){g(N);}y(O);}function y(P){var M=s.length;if(M){for(var N=M-1;N>=0;N--){var O=s.shift();J(O["widget"],O["events"],O["oninit"],O);}M=s.length;}if(M===0){if(!F){XGridLayout.layout();}F=isEmptyObject(q)?"finished":"ready";if(typeof(P)==="function"){P();}}else{setTimeout(function(){y(P);},260);}}function J(N,M,O){if(N.get("widget_xml")&&!N.get("widget_xui")){s.push(arguments[3]||{widget:N,events:M,oninit:O});}else{O(N,M,false);}}function E(O){if(!window["__esen_mainframe4portal"]){return;}try{var M=O.getAttribute("zw"),N=window.screen.width/(M?parseInt(M):1366);if(N&&N!==1){if(isie){var Q=document.createElement("div");Q.innerHTML='<object id="WebBrowser" width=0 height=0 classid="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2"></object>';Q.firstChild.ExecWB(63,1,Math.floor(N*100));}}}catch(P){}}function G(M,O){j={};f=XWidgetFactory.load(M,m,q={});var N=$(m).children("["+PortalConstants.NAME_DATA_ROLE+"="+PortalConstants.VALUE_ROLE_PAGE+"]");if(N.length!==1){throw new Error(I18N.getString("esmain.portal.js.buildpage.js.1","解析内容不正确，data-role属性为page的节点数必须为1."));}E(N.get(0));a(m);PortalEvent.bind(m,g);L(O,e);window.onresize=XGridLayout.layout;}function h(N,O){var M=Array.prototype.slice.call(arguments,2,arguments.length);return function(P){if((P&&(--N)||N)>0){return;}O.apply(null,M);};}function b(M,N){parseXML(M,G,N);}function u(M,R,O,S,U,T,Q){try{if(t){if(Q!==true){return;}window.onunload=o;o=null;c();}else{var N=XWidgetFactory.getInstance();N.addWidgetHandler(PortalConstants.VALUE_ROLE_WIDGET,HtmlWidgetHandler.getInstance());N.addWidgetHandler(PortalConstants.VALUE_ROLE_WIDGET_XUI,XuiWidgetHandler.getInstance());t=XWidgetTemplateFactory.getInstance();}F=false;m=T||document.body;if((d=M)&&x){n=rndIdentity("portal_");o=window.onunload;window.onunload=c;}A={};e=S;t.loadCommon(i,function(){z(R,h(R.length,b,O,U));});}catch(P){showError(P);}}function B(O,N,M){if(O){H=O;}if(N){i=N;}if(M===false){x=false;}}function r(){return F==="ready";}function C(){return F==="finished";}function K(O){var N=false;for(var P in q){var M=q[P];if(M["hidedom"]===O){extendObj(f,M["handler"].load(M["xml"],O,q));delete q[P];N=true;}}if(!N){return;}a(O);PortalEvent.bind(O,g);L(null,e);}function v(){return d;}function c(){try{if(!F){return;}if(x&&d){queryObj(H,Map.create({command:"quitportalpage",id:d,checktype:n}));}for(var M in A){A[M].dispose();}XGridLayout.dispose(m);clearAllContent(m);m=null;A=null;e=null;f=null;F=null;q=null;j=null;if(typeof(o)==="function"){o();}}catch(N){}}function k(N){if(!N||!N.match){return;}var M=N.match(decodeURI(p));if(!M||M.length===0){return;}return M[0];}var w=Object.prototype.toString;D["checkPortalResource"]=function(S){if(!x||!d){return;}var Q=[],R={},U=null;if(w.call(S)==="[object Array]"){for(var O=0,P=S.length;O<P;O++){var N=S[O];if(U=k(N)){R[U]=N;Q.push(U);}}}else{if(U=k(S)){R[U]=S;Q.push(U);}}if(!Q.length){return;}var T=queryObj(H,Map.create({command:"checkportalresource",id:d,checktype:n,res:Q.join(",")}));if(!T){return;}T=T.split(",");var M=[];for(var O=0,P=T.length;O<P;O++){M.push(R[T[O]]);}return M;};D["PageBuilder"]=D["$p"]={build:u,dispose:c,$:g,checkLazyloadWidgets:K,getPortal:v,setAction:B,isReady:r,isFinished:C};if(getRootWindow()===window){window["__esen_mainframe4portal"]={wnd:window,isportal:true};}})(window);