function XUI(d,b,c,a){if(_biInPrototype){return;}XComponent.call(this,d,b,c,a);this._lazy_init_components={};this._is_building_xdialog=false;}_extendClass(XUI,XComponent,"XUI");XUI.prototype.dispose=function(){this._eventListener=null;this._onBuildFinish=null;var a;for(var b in this){a=this[b];if(a&&a.dispose){a.dispose();a=null;}}SanComponent.prototype.dispose.call(this);};XUI.HTML2SCRIPT={"class":"className","valign":"vAlign","maxlength":"maxLength","nowrap":"noWrap","readonly":"readOnly","cellspacing":"cellSpacing","cellpadding":"cellPadding","colspan":"colSpan","rowspan":"rowSpan","bgcolor":"bgColor","bordercolor":"borderColor","tabindex":"tabIndex","for":"htmlFor"};XUI.REGEXP={"displayNone":new RegExp("display( ?: ?)none(;?)","i")};XUI.prototype.build=function(d,b,e){this._is_building_xdialog=false;d=d.documentElement?d.documentElement:d;if(!d.tagName){var c=d.lastIndexOf("/");if(c>0){this._xmlpath=d.substring(0,c+1);}parseXML(d,function(g,f){f.build(g,b,e);},this);return;}var a;this._eventListener=b;this._onBuildFinish=e;this._waitFinishRef=1;this._rootComponentId=null;if(d.tagName.equalsIgnoreCase("xui")){a=this._parseXmlChildNodes(this.parentElement,d);}else{this._rootComponentId=d.getAttribute("id");if(!this._rootComponentId){this._rootComponentId="root_Component_Id_"+Math.floor(Math.random()*999999);d.setAttribute("id",this._rootComponentId);}a=this._parseXmlNode(this.parentElement,d);}this._checkRunBuildFinishEvent(d,a);return a;};XUI.prototype.buildXmlIsland=function(d,b,c,a){this._is_building_xdialog=false;if(typeof(d)=="string"&&d){d=this.doc.getElementById(d);}if(typeof(d)!="object"){return null;}if(d.tagName.toLowerCase()!="xml"){throw new Error("XUI content must be in XML tags inside.");}this.parentElement=a&&a.nodeType==1?a:(d.offsetParent||d.parentNode);return this.build(d.XMLDocument?d.XMLDocument:d.innerHTML,b,c);};XUI.prototype.buildPage=function(a,b){this._is_building_xdialog=false;var h=this.doc.getElementsByTagName("xml");if(!h||h.length==0){return;}this._eventListener=a;this._onBuildFinish=b;this._waitFinishRef=1;this._rootComponentId=null;var c,j,g;for(var d=0,f=h.length;d<f;d++){c=h[0];if(c.XMLDocument){j=c.XMLDocument;}else{g=c.innerHTML;if(!g){continue;}j=loadXMLString(null,g);if((j.nodeType===1&&j.tagName.toLowerCase()==="parsererror")||j.getElementsByTagName("parsererror").length){j=loadXMLString(null,DomUtil.getChildHTML(c,function(l,k){var i=l.nodeType;return i===1||(l.nodeType===3&&!k);}));}}var e=c.parentNode||c.parentElement||c.offsetParent;this._parseXmlNode(e,j.nodeType==9?j.firstChild:j);e.removeChild(c);}this._checkRunBuildFinishEvent();};XUI.prototype.getRootComponent=function(){return this[this._rootComponentId];};XUI.prototype._checkRunBuildFinishEvent=function(c,a){var d=c?c.getAttribute("onload"):null;if(d){var b=this.createEventHandler(d);if(b){b(a,this,c);}}this._waitFinishRef--;if(this._waitFinishRef==0&&this._onBuildFinish){try{this._onBuildFinish(a,this,c);}finally{if(!!this._wnd){this.wnd=this._wnd;this._wnd=null;this._is_building_xdialog=false;}}}};XUI.prototype.getDomById=function(b){var a=this.getComponentById(b);if(a&&typeof(a.__getBaseDom)=="function"){return a.__getBaseDom();}return a;};XUI.prototype.getComponentById=function(b){var a=this[b];if(a){return a;}return this.init_lazy_component(b);};XUI.prototype.init_lazy_component=function(e,d){var c=this._lazy_init_components[e];if(!c){return null;}this._lazy_init_components[e]=undefined;var b=c.xmlnode;var a=b.getAttribute("style");if(d){b.setAttribute("style",a.replace(XUI.REGEXP.displayNone,""));}b.setAttribute("lazyload","false");this._waitFinishRef++;c=this._parseXmlNode(c.pdom,b);this._checkRunBuildFinishEvent(b,c);b.removeAttribute("lazyload");return c;};XUI.prototype.showComponent=function(c,b){var a=this[c];if(a){if(typeof(a.setVisible)=="function"){a.setVisible(b);}else{a.style.display=b?"":"none";}return a;}if(b){return this.init_lazy_component(c,b);}return null;};XUI.prototype._check_component_not_exists=function(a){if(this[a]||this._lazy_init_components[a]){throw new Error(I18N.getString("xui.xui.js.1","已经存在id为{0}的控件了",[a]));}};XUI.prototype._getTagDefaultNeedJs=function(a){return sys.lib.getComponentJs(a);};XUI.prototype._parseXmlNode=function(b,h){var d=h.getAttribute("style");if(d&&d.match(XUI.REGEXP.displayNone)){var g=h.getAttribute("id");if(g&&parseBool(h.getAttribute("lazyload"),true)){this._check_component_not_exists(g);this._lazy_init_components[g]={id:g,pdom:b,xmlnode:h};return;}}var a=h.getAttribute("includejs");if(!a){a="";}var f=this._getTagDefaultNeedJs(this._getRealTagName(h.tagName));if(f){a+=a?","+f:f;}if(a){var c=null;this._waitFinishRef++;sys.lib.includeAsync(a,this.wnd,function(i){if(c){b.removeChild(c);}var j=i._parseXmlNode_sync(b,h);i._checkRunBuildFinishEvent(h,j);},function(){if(b&&b!=b.ownerDocument.body){c=b.appendChild(b.ownerDocument.createTextNode(I18N.getString("xui.xui.js.2","装入中...")));}},this);return;}this._waitFinishRef++;var e=this._parseXmlNode_sync(b,h);this._checkRunBuildFinishEvent(h,e);return e;};XUI.prototype._getRealTagName=function(a){var b=Sys.XUITAGEXTENT[a];return b?b:a;};XUI.prototype._parseXmlNode_sync=function(a,f){var b=this._getRealTagName(f.tagName);if(!b){return;}b=b.toLowerCase();if("xdialog"==b){if(!!this._is_building_xdialog){this._is_building_xdialog=false;throw new Error(I18N.getString("xui.xui.js.4","XUI文件格式非法：创建对话框过程中出现嵌套的对话框标签！"));}this._wnd=this.wnd;this.wnd=getRootWindow();this._is_building_xdialog=true;}var d=this["_build_"+b];if(!d){d=this.wnd["_xui_build_"+b];}if(!d){throw new Error(I18N.getString("xui.xui.js.3","无法解析标签:{0}",[b]));}var c=d.call(this,a,f);var e=f.getAttribute("id");if(e&&c){this._check_component_not_exists(e);this[e]=c;}return c;};XUI.prototype._parseXmlChildNodes=function(b,d){for(var c=0,a=d?d.childNodes.length:0;c<a;c++){var e=d.childNodes[c];switch(e.nodeType){case 1:this._parseXmlNode(b,e);break;case 3:b.appendChild(b.ownerDocument.createTextNode(e.nodeValue));break;}}};XUI.prototype.createEventHandler=function(eventstr){if(!eventstr){return;}var r;var el=this._eventListener;if(el){r=el[eventstr];if(r){return r.bind(el);}}r=this.wnd[eventstr];if(r){return r;}var self=this;if(eventstr.startsWith("function(")){this.wnd.xui=self;this.wnd.xel=el;var r=this.wnd.eval("_a_=function(){\r\nvar xui=window.xui,xel=window.xel; return "+eventstr+"\r\n}")();this.wnd.xui=null;this.wnd.xel=null;return r;}return new Function("xui","xel"," return function(p){\r\n "+eventstr+" \r\n}")(this,el);};XUI.prototype._copyAttributes=function(b,e){for(var d=0;d<b.attributes.length;d++){var c=b.attributes[d];e.setAttribute(c.name,c.value);}};XUI.prototype._setHTMLDomAttributes=function(d,g){for(var f=0,b=d.attributes.length;f<b;f++){var c=d.attributes[f];var e=c.name.toLowerCase();switch(e){case"style":g.style.cssText=c.value;break;case"type":if(!g.tagName.equalsIgnoreCase("input")){g[c.name]=c.value;}break;case"height":g.style.height=c.value;break;case"width":g.style.width=c.value;break;case"class":g.className=c.value;break;default:if(e.startsWith("on")&&e.length>3){var h=this.createEventHandler(c.value);if(h){g[c.name]=h;}}else{var j=XUI.HTML2SCRIPT[e];g[j?j:c.name]=this._getAttributeWithScript(c.value);}break;}}};XUI.prototype._build_common_html_dom=function(a,c){var b=a.appendChild(a.ownerDocument.createElement(c.tagName));this._setHTMLDomAttributes(c,b);this._parseXmlChildNodes(b,c);return b;};XUI.prototype._build_td=function(a,c){var b=a.insertCell(-1);this._setHTMLDomAttributes(c,b);this._parseXmlChildNodes(b,c);return b;};XUI.prototype._build_tr=function(a,c){var b=a.insertRow(-1);this._setHTMLDomAttributes(c,b);this._parseXmlChildNodes(b,c);return b;};XUI.prototype._build_input=function(a,c){var b=a.appendChild(inputElement(a.ownerDocument,c.getAttribute("type"),c.getAttribute("name"),c.getAttribute("value"),parseBool(c.getAttribute("checked"))));this._setHTMLDomAttributes(c,b);return b;};XUI.prototype._build_iframe=function(b,d){var a=d.getAttribute("name");var e=d.getAttribute("id");var c=b.appendChild(b.ownerDocument.createElement((isMSIE&&!isCSS1Compat)?"<iframe"+(a?' name="'+a+'"':"")+(e?' id="'+e+'"':"")+"></iframe>":"iframe"));this._setHTMLDomAttributes(d,c);return c;};XUI.prototype._build_br=function(a,b){return a.appendChild(a.ownerDocument.createElement("br"));};XUI.prototype._build_table=XUI.prototype._build_common_html_dom;XUI.prototype._build_thead=XUI.prototype._build_common_html_dom;XUI.prototype._build_tbody=XUI.prototype._build_common_html_dom;XUI.prototype._build_th=XUI.prototype._build_common_html_dom;XUI.prototype._build_label=XUI.prototype._build_common_html_dom;XUI.prototype._build_img=XUI.prototype._build_common_html_dom;XUI.prototype._build_div=XUI.prototype._build_common_html_dom;XUI.prototype._build_span=XUI.prototype._build_common_html_dom;XUI.prototype._build_fieldset=XUI.prototype._build_common_html_dom;XUI.prototype._build_legend=XUI.prototype._build_common_html_dom;XUI.prototype._build_nobr=XUI.prototype._build_common_html_dom;XUI.prototype._build_select=XUI.prototype._build_common_html_dom;XUI.prototype._build_option=XUI.prototype._build_common_html_dom;XUI.prototype._build_p=XUI.prototype._build_common_html_dom;XUI.prototype._build_form=XUI.prototype._build_common_html_dom;XUI.prototype._build_font=XUI.prototype._build_common_html_dom;XUI.prototype._build_i=XUI.prototype._build_common_html_dom;XUI.prototype._build_em=XUI.prototype._build_common_html_dom;XUI.prototype._build_b=XUI.prototype._build_common_html_dom;XUI.prototype._build_strong=XUI.prototype._build_common_html_dom;XUI.prototype._build_ul=XUI.prototype._build_common_html_dom;XUI.prototype._build_li=XUI.prototype._build_common_html_dom;XUI.prototype._build_hr=XUI.prototype._build_common_html_dom;XUI.prototype._build_h1=XUI.prototype._build_common_html_dom;XUI.prototype._build_h2=XUI.prototype._build_common_html_dom;XUI.prototype._build_h3=XUI.prototype._build_common_html_dom;XUI.prototype._build_h4=XUI.prototype._build_common_html_dom;XUI.prototype._build_h5=XUI.prototype._build_common_html_dom;XUI.prototype._build_h6=XUI.prototype._build_common_html_dom;XUI.prototype._getAttributeWithScript=function(attr){if(attr&&attr.startsWith("javascript:")){return this.wnd.eval(attr.substring(11));}return attr;};XUI.prototype._build_textarea=function(a,c){var b=a.appendChild(a.ownerDocument.createElement("textarea"));this._setHTMLDomAttributes(c,b);b.value=getTextContent4Xml(c);return b;};XUI.prototype._build_script=function(b,c){var a=getCDATASectionValue(c);if(a){this.wnd.xui=this;this.wnd.xel=this._eventListener;this.wnd.xuiScriptParentNode=b;execJavaScript(a,this.wnd);this.wnd.xui=null;this.wnd.xel=null;this.wnd.xuiScriptParentNode=null;}var d=this._getAttributeWithScript(c.getAttribute("src"));if(d){sys.lib.includeAsync(d,this.wnd,this.createEventHandler(c.getAttribute("onfinish")));}};XUI.prototype._build_extjs=function(a,b){includeExtjs(function(c){c._build_script(a,b);},this);};XUI.prototype._build_style=function(a,b){var c=b.getAttribute("id");if(c){if(a.ownerDocument.getElementById(c)){return;}}addStyleSheet(getTextContent4Xml(b),c,getWndOfDom(a));};XUI.prototype._build_link=function(a,c){var d=a.ownerDocument;var b=d.getElementsByTagName("head")[0].appendChild(d.createElement("link"));this._setHTMLDomAttributes(c,b);};XUI.prototype._build_xui=function(a,b){var c=this._getAttributeWithScript(b.getAttribute("src"));if(c){if(this._xmlpath&&c.indexOf("/")==-1){c=this._xmlpath+c;}this._waitFinishRef++;parseXML(c,function(e,d){e=e.documentElement?e.documentElement:e;var f=d._parseXmlNode(a,e);d._checkRunBuildFinishEvent(e,f);},this);}this._parseXmlChildNodes(a,b);};XUI.prototype._build_a=function(a,c){var b=a.appendChild(a.ownerDocument.createElement("a"));this._setHTMLDomAttributes(c,b);if(!b.href){b.href="javascript:undefined";}this._parseXmlChildNodes(b,c);return b;};function _getOptions4XUIComponent(g){var c=g.getElementsByTagName("option");if(!c||c.length==0){return null;}var b;var a,e,f;for(var d=0,h=c.length;d<h;d++){f=c[d];if(!b){b=[];}a=f.getAttribute("value");if(!a){a="";}e=getTextContent4Xml(f);if(!e){e=a;}b.push([a,e]);}return b;}function _setDisabled4XUIComponent(b,a){if(!b||!a||(b.nodeType&&b.nodeType==1)){return;}var c=parseBool(a.getAttribute("disabled"),false);if(typeof(b.setDisabled)=="function"){b.setDisabled(c);}else{if(typeof(b.setEnabled)=="function"){b.setEnabled(!c);}}}var XUIBuilder={};XUIBuilder.buildXml=function(e,b,d,c,f){var a=new XUI(e,b);a.build(d,c,f);return a;};XUIBuilder.buildPage=function(d,b,c,e){var a=new XUI(d,b);a.buildPage(c,e);return a;};