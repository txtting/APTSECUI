function WidgetHandler(){}WidgetHandler.prototype.create=function(a,b){throw new Error("The method 'WidgetHandler.create()' Unimplemented!");};WidgetHandler.prototype.save=function(a,c,d,b){throw new Error("The method 'WidgetHandler.save()' Unimplemented!");};WidgetHandler.prototype.load=function(a,b){throw new Error("The method 'WidgetHandler.load()' Unimplemented!");};WidgetHandler.ATTR_NAMES_SL=[PortalConstants.NAME_DATA_IDENTIFY,PortalConstants.NAME_DATA_NAME,PortalConstants.NAME_DATA_ROLE,PortalConstants.NAME_DATA_WIDGETID,PortalConstants.NAME_DATA_POS,PortalConstants.NAME_DATA_LOCATE,PortalConstants.NAME_DATA_LAYOUT,PortalConstants.NAME_DATA_DROPPABLE,PortalConstants.NAME_DATA_READONLY,PortalConstants.NAME_DATA_NOCONTENT,PortalConstants.NAME_DATA_RELAYOUT].concat(PortalEvent.NAME_DATA_EVENTS);WidgetHandler.ATTR_NAMES_UNAVAILABLE=["id",PortalConstants.NAME_DATA_IDENTIFY,PortalConstants.NAME_DATA_WIDGETID,PortalConstants.NAME_DATA_PROPERTY];WidgetHandler.ATTR_NAMES_IGNORE4SAVE=[];WidgetHandler.createNode=ieVersion<8?function(d,h){var c=WidgetHandler.ATTR_NAMES_UNAVAILABLE;var a=d.attributes,f=null,g=null,k={},j=[];for(var b=0,e=a.length;b<e;b++){f=a[b];g=f["name"].toLowerCase();if(c.indexOf(g)!=-1){continue;}k[g]=f["value"];}WidgetHandler.helper.saveTag(j,d.tagName.toLowerCase(),0,k);var l=h.createElement("div");l.innerHTML=j.join("");l=l.firstChild;return l.nodeType===1?l:l.nextSibling;}:function(e,j){var d=WidgetHandler.ATTR_NAMES_UNAVAILABLE;var a=j.createElement(e.tagName);var b=e.attributes,g=null,h=null;for(var c=0,f=b.length;c<f;c++){g=b[c];h=g["name"].toLowerCase();if(d.indexOf(h)!=-1){continue;}a.setAttribute(h,g["value"]);}return a;};WidgetHandler.saveNodeAttribute=function(b,j){var l=/^jquery/i;if(ieVersion<8){var c=WidgetHandler.ATTR_NAMES_SL.concat(["class","name","value","href","src","target","type","title","readOnly","disabled","maxLength"]);var e={readOnly:"false",disabled:"false",maxLength:"2147483647"};WidgetHandler.saveNodeAttribute=function(o,q){var w={},u=[],n=null,v=null;if(q){for(var r=0,s=c.length;r<s;r++){n=c[r],v=o.attributes[n];if(!v||(v=v["value"])==="null"||v===e[n]){continue;}w[n]=v;u.push(n);}if(o.checked){w["checked"]="true";u.push("checked");}v=o.style.cssText;if(v){w["style"]=v;u.push("style");}var p=o.attributes,t=null,x=WidgetHandler.ATTR_NAMES_IGNORE4SAVE;for(var r=0,s=p.length;r<s;r++){t=p[r];if(!t["specified"]){continue;}n=t["name"];if(l.test(n)||u.indexOf(n)!==-1||x.indexOf(n)!==-1){continue;}v=t["value"];if(v=="[object Object]"){continue;}w[n]=v;u.push(n);}}else{var p=o.attributes,t=null;for(var r=0,s=p.length;r<s;r++){t=p[r],v=t["value"],n=t["name"];w[n]=v;u.push(n);}}return[w,u];};}else{var k=WidgetHandler.ATTR_NAMES_SL;var f=function(o,n){var q=k.indexOf(o),p=k.indexOf(n);if(q==-1&&p==-1){return o>n;}if(q==-1){return 1;}if(p==-1){return -1;}return(q>p)?1:-1;};var a=document.createElement("div"),i=$relpath,m="xui/images/null.gif";a.style.backgroundImage="url("+i+m+")";var h=a.style.backgroundImage;var d=h.substring(4,h.length-m.length-1);if(d.charAt(0)==='"'){d=d.substring(1,d.length-1);}var g=d!==i?function(n){return n?n.replace(d,i):"";}:function(n){return n?n:"";};WidgetHandler.saveNodeAttribute=function(n,q){var v={},t=[],o=n.attributes,s=null,u=null,w=WidgetHandler.ATTR_NAMES_IGNORE4SAVE;for(var p=0,r=o.length;p<r;p++){s=o[p];u=s["name"];if(l.test(u)||w.indexOf(u)!==-1){continue;}v[u]=g(s["value"]);t.push(u);}return[v,q?t.sort(f):t];};}return WidgetHandler.saveNodeAttribute(b,j);};WidgetHandler.helper=(function(){var e="\r\n",n="\t",k=" ",b="=",f="'",l="<",m="</",h=">",j="/>",i="<![CDATA[",a="]]>";function g(p){return e+(new Array((p||0)+1).join(n));}function o(s,r,p){var q=g(p||0);s.push(q);s.push(i);s.push(e);s.push(r);s.push(q);s.push(a);}function d(r,p,q){r.push(k);r.push(p);r.push(b);r.push(f);r.push(q.toHTML());r.push(f);}function c(z,r,y,u,t,D){var p=g(y);z.push(p);z.push(l);z.push(r);if(u){if(t){for(var w=0,q=null,B=null,x=t.length;w<x;w++){q=t[w];B=u[q];if(B){d(z,q,B);}}}else{for(var w in u){d(z,w,u[w]);}}}z.push(h);var v=z.length,C=0;if(D){var s=D["func"],A=D["args"]||[];if(typeof(s)=="function"){A.unshift(z);s.apply(D["scope"],A);}C=z.length-v;if(!C&&D["fulltag"]){C=1;}}if(!C){z.pop();z.push(j);return;}if(C!=1){z.push(p);}z.push(m);z.push(r);z.push(h);}return{getSpace:g,saveCDATA:o,saveAttr:d,saveTag:c};})();HtmlWidgetHandler=(function(){var d=null;function b(){b._superClass.call(this);d=XWidgetFactory.getInstance();}extendClass(b,WidgetHandler,"HtmlWidgetHandler");function c(h,e,l){if(h.nodeType!=1){var g=h.nodeValue.replace(/\r|\n|\t/g,"");return g?l.createTextNode(g.unHTML()):null;}var k=WidgetHandler.createNode(h,l);var j=k.getAttribute(PortalConstants.NAME_DATA_NAME);if(j){e[j]=k;}var i=h.firstChild,f=null;while(i){f=c(i,e,l);if(f){k.appendChild(f);}i=i.nextSibling;}return k;}b.prototype.create=function(f,g){var e={};var h=c(f,e,document);g.appendChild(h);e["widget_div"]=h;return e;};b.prototype.save=function(i,h,e,f){var g=function(q,n,k){if(n.getAttribute(PortalConstants.NAME_DATA_NOCONTENT)=="true"){return;}var l=n.firstChild,m=l&&(l.nextSibling!==null),j=null,p=null,o=null;while(l){if(l.nodeType!==1){j=l.nodeValue.replace(/\r|\n|\t/g,"");if(j){if(m){if(!o){o=WidgetHandler.helper.getSpace(k);}q.push(o);}q.push(j.toHTML());}}else{p=l.getAttribute(PortalConstants.NAME_DATA_ROLE);(p?d.getWidgetHandler(p):this).save(q,l,k);}l=l.nextSibling;}};b.prototype.save=function(n,l,j,k){if(l.getAttribute(PortalConstants.NAME_DATA_UNSAVE)=="true"){return;}j=j||0;var m=WidgetHandler.saveNodeAttribute(l,true);WidgetHandler.helper.saveTag(n,l.tagName.toLowerCase(),j,m[0],m[1],{scope:this,args:[l,j+1],func:g});if(k){return n.join("");}};return b.prototype.save.call(this,i,h,e,f);};b.prototype.load=function(m,q,f){var g=m.getAttribute(PortalConstants.NAME_DATA_IDENTIFY),r=false,s=null;if(f){s=f["__$hide_dom$__"];if(g){if(s){f["_$lazy$_"+g]={xml:m,pnode:q,handler:this,hidedom:s};return;}}r=true;}var h=[],l=null;var i=q.appendChild(WidgetHandler.createNode(m,document));if(r&&(r=getCurrentStyle(i,"display")==="none")){f["__$hide_dom$__"]=i;}if(g){h[0]={};l=h[0][g]={widget_div:i};i.setAttribute(PortalConstants.NAME_DATA_IDENTIFY,g);var k=m.getAttribute(PortalConstants.NAME_DATA_WIDGETID);if(k){i.setAttribute(PortalConstants.NAME_DATA_WIDGETID,k);}}else{l=h[1]={};}var p=m.getAttribute(PortalConstants.NAME_DATA_NAME);if(p){l[p]=i;}var e=m.firstChild,o=null,n=null,j=null;while(e){if(e.nodeType!==1){o=e.nodeValue.replace(/\r|\n|\t/g,"");if(o){i.appendChild(document.createTextNode(o.unHTML()));}}else{n=e.getAttribute(PortalConstants.NAME_DATA_ROLE);if(j=(n?d.getWidgetHandler(n):this).load(e,i,f)){if(j.length){h[0]=$.extend(h[0],j[0]);l=$.extend(l,j[1]);}else{h[0]=$.extend(h[0],j);}}}e=e.nextSibling;}if(r){if(s){f["__$hide_dom$__"]=s;}else{delete f["__$hide_dom$__"];}}return g?h[0]:h;};var a=new b();return{getInstance:function(){return a;}};})();XuiWidgetHandler=(function(){function b(){b._superClass.call(this);}extendClass(b,WidgetHandler,"XuiWidgetHandler");b.prototype.create=function(e,f){var c={};var h=f.appendChild(WidgetHandler.createNode(e,document));var g=h.getAttribute(PortalConstants.NAME_DATA_NAME);if(g){c[g]=h;}c["widget_div"]=h;e=c["widget_xml"]=e.cloneNode(true);var d=e.firstChild;while(d.nodeType!=1){d=d.nextSibling;}c["widget_xuixml"]=d;var i=rndIdentity("xuiwidget_");d.setAttribute("id",i);new XUI(window,h,"100%","100%").build(d,null,function(k,j){c["widget_xui"]=j[i];d.removeAttribute("id");});return c;};b.prototype.save=function(h,f,d,e){var g=function(o,k,j){if(k.getAttribute(PortalConstants.NAME_DATA_NOCONTENT)=="true"){return;}var l=k.firstChild,m=l&&(l.nextSibling!==null),i=null,n=null;while(l){if(l.nodeType!=1){i=l.nodeValue.replace(/\r|\n|\t/g,"");if(i){if(m){if(!n){n=WidgetHandler.helper.getSpace(j);}o.push(n);}o.push(i.toHTML());}}else{c(o,l,j,WidgetHandler.saveNodeAttribute(l));}l=l.nextSibling;}};var c=function(l,j,i,k){WidgetHandler.helper.saveTag(l,j.tagName.toLowerCase(),i,k[0],k[1],{scope:this,args:[j,i+1],func:g});};b.prototype.save=function(o,m,i,l){if(m.getAttribute(PortalConstants.NAME_DATA_UNSAVE)=="true"){return;}i=i||0;var n=m._widget,j=null;if(!n){var k=XWidgetTemplateFactory.getInstance().getTemplate(m.getAttribute(PortalConstants.NAME_DATA_WIDGETID));if(!k){throw new Error(I18N.getString("esmain.pagedesigner.js.xwidgethandler.js.1","获取组件模版对象异常,无法保存."));}j=k.getProperty(XWidgetTemplateFactory.TEMPLATE_UIRENDER);}else{j=n.get("widget_xml");}c(o,j,i,WidgetHandler.saveNodeAttribute(m,true));if(l){return o.join("");}};return b.prototype.save.call(this,h,f,d,e);};b.prototype.load=function(d,f){var c=this.create(d,f);var h=c["widget_div"];var g={};var i=d.getAttribute(PortalConstants.NAME_DATA_IDENTIFY),e=d.getAttribute(PortalConstants.NAME_DATA_WIDGETID);if(!i||!e){throw new Error(I18N.getString("esmain.pagedesigner.js.xwidgethandler.js.2","XUI组件内容已损坏，缺少唯一标识符及组件标识符."));}h.setAttribute(PortalConstants.NAME_DATA_IDENTIFY,i);if(e){h.setAttribute(PortalConstants.NAME_DATA_WIDGETID,e);}g[i]=c;return g;};var a=new b();return{getInstance:function(){return a;}};})();